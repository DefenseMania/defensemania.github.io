<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
		<script type="text/javascript" src="processing.min.js"></script>
		<link href='http://fonts.googleapis.com/css?family=Bitter:400,700,400italic' rel='stylesheet' type='text/css'>
		<style>
			body,html { padding:0; margin: 0; }
		</style>
	</head>
	<body>

	<canvas id="dm"></canvas>
	
	<script type="text/javascript">
    var sketch = 
	(function($p){var Collection=function(){function Collection(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}function sort$2(inputList,inputObject){if($p.__instanceof(inputObject,displayComparator)){inputList.sort(displaySortFunction)}else if($p.__instanceof(inputObject,enemyComparator)){inputList.sort(enemySortFunction)}}$p.addMethod($this_1,"sort",sort$2,false);function $constr_0(){$superCstr()}function $constr(){if(arguments.length===0){$constr_0.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return Collection}();$p.Collection=Collection;var ACTIONS=function(){function ACTIONS(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.defenseMap=null;$this_1.timer=0;$this_1.action=0;$this_1.guiFont=null;$this_1.startGameBool=null;function startMessage$0(){$this_1.timer=$p.millis();$this_1.action=5;$this_1.defenseMap.theAnimations.addAnimation($this_1.$self,[[1,$p.width/2,0,800,500,0],[2,$p.height/2,0,800,500,0],[0,0,1,800,500,0]])}$p.addMethod($this_1,"startMessage",startMessage$0,false);function displayStartMessage$0(){$this_1.defenseMap.theAnimations.animate($this_1.$self);$p.textAlign($p.CENTER);$p.textFont($this_1.guiFont,24);$p.fill(0);$p.text("The game will start when\nyou build the first tower",$p.width/2-1,$p.height/2-1);$p.fill(255);$p.text("The game will start when\nyou build the first tower",$p.width/2,$p.height/2);$p.textAlign($p.LEFT);$this_1.defenseMap.theAnimations.animateEnd($this_1.$self)}$p.addMethod($this_1,"displayStartMessage",displayStartMessage$0,false);function startGame$0(){$this_1.defenseMap.gameStarted=true;$this_1.timer=$p.millis();$this_1.action=1;$this_1.defenseMap.theAnimations.addAnimation($this_1.$self,[[1,$p.width/2,0,800,1e3,0],[2,$p.height/2,0,800,1e3,0],[0,0,1,800,1e3,0]])}$p.addMethod($this_1,"startGame",startGame$0,false);function startGameDisplay$0(){var theText="";$p.textAlign($p.CENTER);$p.textFont($this_1.guiFont,64);if($p.millis()-$this_1.timer<=3e3){$p.textFont($this_1.guiFont,48);theText="Prepare!"}else if($p.millis()-$this_1.timer<=4e3){if($this_1.startGameBool[0]==false){$this_1.defenseMap.theAnimations.addAnimation($this_1.$self,[[1,$p.width/2,0,200,0,0],[2,$p.height/2,0,200,0,0],[0,0,1,200,0,0]]);$this_1.startGameBool[0]=true}theText="3"}else if($p.millis()-$this_1.timer<=5e3){if($this_1.startGameBool[1]==false){$this_1.defenseMap.theAnimations.addAnimation($this_1.$self,[[1,$p.width/2,0,200,0,0],[2,$p.height/2,0,200,0,0],[0,0,1,200,0,0]]);$this_1.startGameBool[1]=true}theText="2"}else if($p.millis()-$this_1.timer<=6e3){if($this_1.startGameBool[2]==false){$this_1.defenseMap.theAnimations.addAnimation($this_1.$self,[[1,$p.width/2,0,200,0,0],[2,$p.height/2,0,200,0,0],[0,0,1,200,0,0]]);$this_1.startGameBool[2]=true}theText="1"}else{if($this_1.startGameBool[3]==false){$this_1.defenseMap.theAnimations.addAnimation($this_1.$self,[[1,$p.width/2,0,200,0,0],[2,$p.height/2,0,200,0,0],[0,0,1,200,0,0]]);$this_1.startGameBool[3]=true}$p.textFont($this_1.guiFont,72);theText="GO!"}$this_1.defenseMap.theAnimations.animate($this_1.$self);$p.fill(0);$p.text(theText,$p.width/2-2,$p.height/2-2);$p.fill(255);$p.text(theText,$p.width/2,$p.height/2);$p.textAlign($p.LEFT);$this_1.defenseMap.theAnimations.animateEnd($this_1.$self)}$p.addMethod($this_1,"startGameDisplay",startGameDisplay$0,false);function continueNextWave$0(){$this_1.timer=$p.millis();$this_1.action=2}$p.addMethod($this_1,"continueNextWave",continueNextWave$0,false);function wonGame$0(){$this_1.timer=$p.millis();$this_1.action=3;globalSpeed=0;$this_1.defenseMap.defeated=true}$p.addMethod($this_1,"wonGame",wonGame$0,false);function displayWonGame$0(){$p.textAlign($p.CENTER);$p.textFont($this_1.guiFont,64);$p.fill(0);$p.text("Victory!",$p.width/2-2,$p.height/2-2);$p.fill(255);$p.text("Victory!",$p.width/2,$p.height/2);$p.textAlign($p.LEFT)}$p.addMethod($this_1,"displayWonGame",displayWonGame$0,false);function loseGame$0(){$this_1.timer=$p.millis();$this_1.action=4;$this_1.defenseMap.defeated=true;globalSpeed=0}$p.addMethod($this_1,"loseGame",loseGame$0,false);function displayLoseGame$0(){$p.textAlign($p.CENTER);$p.textFont($this_1.guiFont,64);$p.fill(0);$p.text("Defeated!",$p.width/2-2,$p.height/2-2);$p.fill(255);$p.text("Defeated!",$p.width/2,$p.height/2);$p.textAlign($p.LEFT)}$p.addMethod($this_1,"displayLoseGame",displayLoseGame$0,false);function displayActions$0(){switch($this_1.action){case 0:break;case 1:if($p.millis()-$this_1.timer<=8e3){$this_1.$self.startGameDisplay()}else{$this_1.defenseMap.enemyWaves.nextWave();$this_1.action=0;$this_1.startGameBool=$p.createJavaArray("boolean",[4])}break;case 2:if($p.millis()-$this_1.timer>=2e3){$this_1.defenseMap.enemyWaves.nextWave();$this_1.action=0}break;case 3:if($p.millis()-$this_1.timer<=3e3){$this_1.$self.displayWonGame()}else{$this_1.action=0;showAfterMatch(true)}break;case 4:if($p.millis()-$this_1.timer<=3e3){$this_1.$self.displayLoseGame()}else{$this_1.action=0;showAfterMatch(false)}break;case 5:if($p.millis()-$this_1.timer<=5e3){$this_1.$self.displayStartMessage()}break}}$p.addMethod($this_1,"displayActions",displayActions$0,false);function $constr_1(idefenseMap){$superCstr();$this_1.defenseMap=idefenseMap;$this_1.guiFont=$p.createFont("Arial Black",72);$this_1.startGameBool=$p.createJavaArray("boolean",[4])}function $constr(){if(arguments.length===1){$constr_1.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return ACTIONS}();$p.ACTIONS=ACTIONS;var AFTERMATCH=function(){function AFTERMATCH(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.replayButton=null;$this_1.menuButton=null;$this_1.exitButton=null;$this_1.buttonDistance=($p.width-160*3)/4;$this_1.wonTheGame=false;function display$0(){$p.pushMatrix();$p.translate(0,$p.height*2);$p.textFont(fpsFont,48);$p.textAlign($p.CENTER);if($this_1.wonTheGame==true){$p.text("WELL DONE!",$p.width/2,$p.height/2-20)}else{$p.text("MAYBE NEXT TIME ...",$p.width/2,$p.height/2-20)}$this_1.replayButton.display();$this_1.menuButton.display();$this_1.exitButton.display();$p.popMatrix()}$p.addMethod($this_1,"display",display$0,false);function mouseClicked$0(){if($this_1.replayButton.mouseOverButton()==true){startGame(mapNameTemp,difficultyTemp)}else if($this_1.menuButton.mouseOverButton()==true){theMenu.changeScreen(1)}else if($this_1.exitButton.mouseOverButton()==true){$p.exit()}}$p.addMethod($this_1,"mouseClicked",mouseClicked$0,false);function $constr_1(iwonTheGame){$superCstr();$this_1.wonTheGame=iwonTheGame;$this_1.replayButton=new BUTTON(0,"PLAY AGAIN",$p.parseInt($this_1.buttonDistance),$p.height-65,160,26);$this_1.menuButton=new BUTTON(0,"BACK TO MENU",$p.parseInt($this_1.buttonDistance*2)+160,$p.height-65,160,26);$this_1.exitButton=new BUTTON(0,"EXIT GAME",$p.parseInt($this_1.buttonDistance*3)+320,$p.height-65,160,26)}function $constr(){if(arguments.length===1){$constr_1.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return AFTERMATCH}();$p.AFTERMATCH=AFTERMATCH;var ANIMATION=function(){function ANIMATION(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.theObject=null;$this_1.parameters=null;$this_1.theAnimations=null;$this_1.animationAngle=0;$this_1.animationStart=0;$this_1.animationValue=null;$this_1.animationSub=null;$this_1.animationTime=0;$this_1.looping=false;function calcAngle$1(i){if($this_1.parameters[i][1]>$this_1.parameters[i][2]){if($this_1.parameters[i][2]<0){$this_1.animationSub[i]=$this_1.parameters[i][2];$this_1.parameters[i][1]+=$p.abs($this_1.parameters[i][2]);$this_1.parameters[i][2]=0}$this_1.animationAngle[i]=$p.atan($p.abs($this_1.parameters[i][2]-$this_1.parameters[i][1])/$this_1.parameters[i][3])}else{if($this_1.parameters[i][1]<0){$this_1.animationSub[i]=$this_1.parameters[i][1];$this_1.parameters[i][2]+=$p.abs($this_1.parameters[i][1]);$this_1.parameters[i][1]=0}$this_1.animationAngle[i]=$p.atan(($this_1.parameters[i][2]-$this_1.parameters[i][1])/$this_1.parameters[i][3])}}$p.addMethod($this_1,"calcAngle",calcAngle$1,false);function startAnim$0(){$p.pushMatrix();for(var i=0;i<$this_1.parameters.length;i++){if($this_1.parameters[i][5]==1){if($this_1.animationValue[i]==$this_1.parameters[i][2]){var temp=$this_1.parameters[i][2];$this_1.parameters[i][2]=$this_1.parameters[i][1];$this_1.parameters[i][1]=temp;$this_1.animationValue[i]=$this_1.parameters[i][1];$this_1.animationStart=$p.millis()-$this_1.parameters[i][4];$this_1.$self.calcAngle(i)}}switch($this_1.parameters[i][0]){case 0:$p.scale($this_1.animationValue[i]);break;case 1:$p.translate($this_1.animationValue[i],0);break;case 2:$p.translate(0,$this_1.animationValue[i]);break;case 3:$p.tint(255,$this_1.animationValue[0]);break;case 4:$p.tint($this_1.animationValue[0],255,255);break;case 5:$p.tint(255,$this_1.animationValue[0],255);break;case 6:$p.tint(255,255,$this_1.animationValue[0]);break}if(($p.millis()<$this_1.animationStart+$this_1.parameters[i][3]+$this_1.parameters[i][4]||$this_1.parameters[i][5]==1)&&$p.millis()>$this_1.animationStart+$this_1.parameters[i][4]){if($this_1.parameters[i][1]>$this_1.parameters[i][2]){$this_1.animationValue[i]=$p.tan($this_1.animationAngle[i])*($this_1.parameters[i][3]-$p.__int_cast($p.millis()-($this_1.animationStart+$this_1.parameters[i][4])))}else{$this_1.animationValue[i]=$p.tan($this_1.animationAngle[i])*($p.millis()-($this_1.animationStart+$this_1.parameters[i][4]))}}if($this_1.animationSub[i]!=0){$this_1.animationValue[i]+=$this_1.animationSub[i]}}if($p.millis()>=$this_1.animationTime+$this_1.animationStart&&$this_1.looping==false){$p.popMatrix();$p.noTint();$this_1.theAnimations.removeAnimation($this_1.$self)}}$p.addMethod($this_1,"startAnim",startAnim$0,false);function endAnim$0(){$p.popMatrix();$p.noTint()}$p.addMethod($this_1,"endAnim",endAnim$0,false);function $constr_3(itheAnimations,itheObject,iparameters){$superCstr();$this_1.theAnimations=itheAnimations;$this_1.theObject=itheObject;$this_1.parameters=iparameters;$this_1.animationValue=$p.createJavaArray("float",[$this_1.parameters.length]);$this_1.animationAngle=$p.createJavaArray("float",[$this_1.parameters.length]);$this_1.animationSub=$p.createJavaArray("int",[$this_1.parameters.length]);for(var i=0;i<$this_1.parameters.length;i++){if($this_1.parameters[i][5]==1){$this_1.looping=true}$this_1.animationSub[i]=0;$this_1.$self.calcAngle(i);$this_1.animationValue[i]=$this_1.parameters[i][1]+$this_1.animationSub[i];if($this_1.animationTime<$this_1.parameters[i][3]+$this_1.parameters[i][4]){$this_1.animationTime=$this_1.parameters[i][3]+$this_1.parameters[i][4]}$this_1.animationStart=$p.millis()}}function $constr(){if(arguments.length===3){$constr_3.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return ANIMATION}();$p.ANIMATION=ANIMATION;var ANIMATIONS=function(){function ANIMATIONS(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.anims=null;function addAnimation$2(itheObject,iparameters){$this_1.anims.add(new ANIMATION($this_1.$self,itheObject,iparameters))}$p.addMethod($this_1,"addAnimation",addAnimation$2,false);function removeAnimation$1(iani){for(var i=0;i<$this_1.anims.size();i++){var temp=$this_1.anims.get(i);if($p.__equals(temp,iani)==true||$p.__equals(temp.theObject,iani)==true){temp=null;$this_1.anims.remove(i);break}}}$p.addMethod($this_1,"removeAnimation",removeAnimation$1,false);function animate$1(iobject){for(var i=0;i<$this_1.anims.size();i++){var temp=$this_1.anims.get(i);if($p.__equals(temp.theObject,iobject)==true){temp.startAnim();break}}}$p.addMethod($this_1,"animate",animate$1,false);function animateEnd$1(iobject){for(var i=0;i<$this_1.anims.size();i++){var temp=$this_1.anims.get(i);if($p.__equals(temp.theObject,iobject)==true){temp.endAnim();break}}}$p.addMethod($this_1,"animateEnd",animateEnd$1,false);function $constr_0(){$superCstr();$this_1.anims=new $p.ArrayList}function $constr(){if(arguments.length===0){$constr_0.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return ANIMATIONS}();$p.ANIMATIONS=ANIMATIONS;var BUILDMENU=function(){function BUILDMENU(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.defenseMap=null;$this_1.font=null;$this_1.towerIcons=null;$this_1.bmRadius=0;$this_1.bmAngle=0;$this_1.bmPosition=null;$this_1.iconSize=0;$this_1.iconCount=0;$this_1.distanceFromBorderX=0;$this_1.distanceFromBorderY=0;function display$0(){$this_1.defenseMap.theAnimations.animate($this_1.$self);$p.pushMatrix();var x=inputHandler.mapToWinX(($this_1.bmPosition[0]+.5)*$this_1.defenseMap.tileSize+$this_1.distanceFromBorderX);var y=inputHandler.mapToWinY(($this_1.bmPosition[1]+.5)*$this_1.defenseMap.tileSize+$this_1.distanceFromBorderY);$p.translate(-x*($this_1.defenseMap.theGui.menuScale-1),-y*($this_1.defenseMap.theGui.menuScale-1));$p.scale($this_1.defenseMap.theGui.menuScale);$p.ellipseMode($p.CENTER);$p.noFill();$p.stroke(204,255,153,200);$p.ellipse(x,y,$this_1.bmRadius*2,$this_1.bmRadius*2);$p.ellipseMode($p.CORNER);for(var i=0;i<$this_1.iconCount;i++){$p.imageMode($p.CENTER);if(antiAliasing==true&&globalPlatform==1){$p.tint(255)}if($this_1.defenseMap.theGui.money<$this_1.defenseMap.theTowers.towerTypes[i].costs){$p.tint(150,200)}$p.image($this_1.towerIcons[i],x+$p.sin($this_1.bmAngle*i)*$this_1.bmRadius,y+$p.cos($this_1.bmAngle*i)*$this_1.bmRadius,$this_1.iconSize,$this_1.iconSize);$p.textAlign($p.CENTER);$p.textFont($this_1.font,10);$p.fill(0,190);$p.noStroke();$p.rectMode($p.CENTER);$p.rect(x+$p.sin($this_1.bmAngle*i)*$this_1.bmRadius,y+$p.cos($this_1.bmAngle*i)*$this_1.bmRadius+$this_1.iconSize/5+2,$this_1.iconSize*.8,$this_1.iconSize/3);$p.fill(255);$p.text($this_1.defenseMap.theTowers.towerTypes[i].costs+" $",x+$p.sin($this_1.bmAngle*i)*$this_1.bmRadius,y+$p.cos($this_1.bmAngle*i)*$this_1.bmRadius+$this_1.iconSize/3+1);$p.textAlign($p.LEFT);$p.imageMode($p.CORNER);$p.rectMode($p.CORNER);$p.noTint()}$p.popMatrix();$this_1.defenseMap.theAnimations.animateEnd($this_1.$self)}$p.addMethod($this_1,"display",display$0,false);function mouseOver$2(x,y){var returnVar=-1;for(var i=0;i<$this_1.iconCount;i++){var distance=$p.dist(x,y,(($this_1.bmPosition[0]+.5)*$this_1.defenseMap.tileSize+$this_1.distanceFromBorderX)*$this_1.defenseMap.zoom+$p.sin($this_1.bmAngle*i)*($this_1.bmRadius*$this_1.defenseMap.theGui.menuScale),(($this_1.bmPosition[1]+.5)*$this_1.defenseMap.tileSize+$this_1.distanceFromBorderY)*$this_1.defenseMap.zoom+$p.cos($this_1.bmAngle*i)*($this_1.bmRadius*$this_1.defenseMap.theGui.menuScale));if(distance<=$p.__int_cast($this_1.iconSize/2)+4){returnVar=i;break}}return returnVar}$p.addMethod($this_1,"mouseOver",mouseOver$2,false);function $constr_1(idefenseMap){$superCstr();$this_1.font=$p.createFont("Arial",48);$this_1.defenseMap=idefenseMap;$this_1.bmPosition=pixelToTiles(inputHandler.winToMapX(mouseXp),inputHandler.winToMapY(mouseYp),$this_1.defenseMap.tileSize);$this_1.iconCount=$this_1.defenseMap.theTowers.towerTypes.length;$this_1.iconSize=$this_1.defenseMap.theTowers.towerTypes[0].towerIconSize;$this_1.towerIcons=$p.createJavaArray("$p.PImage",[$this_1.iconCount]);for(var i=0;i<$this_1.iconCount;i++){$this_1.towerIcons[i]=$p.loadImage($this_1.defenseMap.mapPath+"/data/"+$this_1.defenseMap.theTowers.towerTypes[i].towerIcon)}$this_1.bmRadius=$p.__int_cast($this_1.iconSize*1.5*$this_1.iconCount/(2*$p.PI));$this_1.bmAngle=2*$p.PI/$this_1.iconCount;if($this_1.bmRadius<$this_1.iconSize*.6){$this_1.bmRadius=$p.__int_cast($this_1.iconSize*.6)}if($this_1.bmPosition[0]==0){$this_1.distanceFromBorderX=$this_1.bmRadius+$p.__int_cast($this_1.iconSize/2)-$p.__int_cast($this_1.defenseMap.tileSize/2)}if($this_1.bmPosition[0]==$this_1.defenseMap.mapSize[0]-1){$this_1.distanceFromBorderX=-($this_1.bmRadius+$p.__int_cast($this_1.iconSize/2)-$p.__int_cast($this_1.defenseMap.tileSize/2))}if($this_1.bmPosition[1]==0){$this_1.distanceFromBorderY=$this_1.bmRadius+$p.__int_cast($this_1.iconSize/2)-$p.__int_cast($this_1.defenseMap.tileSize/2)}if($this_1.bmPosition[1]==$this_1.defenseMap.mapSize[1]-1){$this_1.distanceFromBorderY=-($this_1.bmRadius+$p.__int_cast($this_1.iconSize/2)-$p.__int_cast($this_1.defenseMap.tileSize/2))}}function $constr(){if(arguments.length===1){$constr_1.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return BUILDMENU}();$p.BUILDMENU=BUILDMENU;var BUTTON=function(){function BUTTON(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.buttonText=null;$this_1.w=0;$this_1.h=0;$this_1.x=0;$this_1.y=0;$this_1.scrollOffset=0;$this_1.isMouseOver=false;$this_1.isMouseClick=false;$this_1.isActive=false;$this_1.isLocked=false;$this_1.buttonFont=null;$this_1.type=0;function mouseOverButton$0(){if(mouseXp>=$this_1.x&&mouseXp<=$this_1.x+$this_1.w&&mouseYp>=$this_1.y+$this_1.scrollOffset&&mouseYp<=$this_1.y+$this_1.h+$this_1.scrollOffset){return true}else{return false}}$p.addMethod($this_1,"mouseOverButton",mouseOverButton$0,false);function mouseOver$0(){if(mouseXp>=$this_1.x&&mouseXp<=$this_1.x+$this_1.w&&mouseYp>=$this_1.y+$this_1.scrollOffset&&mouseYp<=$this_1.y+$this_1.h+$this_1.scrollOffset){if($p.__mousePressed==true){$this_1.isMouseClick=true;$this_1.isMouseOver=false}else{$this_1.isMouseOver=true;$this_1.isMouseClick=false}}else{$this_1.isMouseOver=false;$this_1.isMouseClick=false}}$p.addMethod($this_1,"mouseOver",mouseOver$0,false);function display$0(){$this_1.$self.mouseOver();if(theAnimations!=null){theAnimations.animate($this_1.$self)}$p.imageMode($p.CORNER);$p.textAlign($p.CENTER);if($this_1.isLocked==true){if($this_1.type!=3){$p.stroke(255,100);$p.line($this_1.x,$this_1.y+$this_1.h-1,$this_1.x+$this_1.w,$this_1.y+$this_1.h-1);if($this_1.type==1){$p.line($this_1.x,$this_1.y-1,$this_1.x+$this_1.w,$this_1.y-1)}$p.line($this_1.x,$this_1.y+$this_1.h,$this_1.x+$this_1.w,$this_1.y+$this_1.h);if($this_1.type==1){$p.line($this_1.x,$this_1.y,$this_1.x+$this_1.w,$this_1.y)}}$p.fill(255,100)}else if($this_1.isActive==true){if($this_1.type!=3){$p.stroke(4287232511);$p.line($this_1.x,$this_1.y+$this_1.h-1,$this_1.x+$this_1.w,$this_1.y+$this_1.h-1);if($this_1.type==1){$p.line($this_1.x,$this_1.y-1,$this_1.x+$this_1.w,$this_1.y-1)}$p.stroke(4278196231);$p.line($this_1.x,$this_1.y+$this_1.h,$this_1.x+$this_1.w,$this_1.y+$this_1.h);if($this_1.type==1){$p.line($this_1.x,$this_1.y,$this_1.x+$this_1.w,$this_1.y)}}$p.fill(4287232511)}else if($this_1.isMouseClick==true){$p.fill(4287232511)}else if($this_1.isMouseOver==true){if($this_1.type!=3){$p.stroke(4287232511);$p.line($this_1.x,$this_1.y+$this_1.h-1,$this_1.x+$this_1.w,$this_1.y+$this_1.h-1);if($this_1.type==1){$p.line($this_1.x,$this_1.y-1,$this_1.x+$this_1.w,$this_1.y-1)}$p.stroke(4278196231);$p.line($this_1.x,$this_1.y+$this_1.h,$this_1.x+$this_1.w,$this_1.y+$this_1.h);if($this_1.type==1){$p.line($this_1.x,$this_1.y,$this_1.x+$this_1.w,$this_1.y)}}$p.fill(255)}else{$p.fill(255,190);if($this_1.type!=3){$p.stroke(4294499778);$p.line($this_1.x,$this_1.y+$this_1.h-1,$this_1.x+$this_1.w,$this_1.y+$this_1.h-1);if($this_1.type==1){$p.line($this_1.x,$this_1.y-1,$this_1.x+$this_1.w,$this_1.y-1)}$p.stroke(4280619010);$p.line($this_1.x,$this_1.y+$this_1.h,$this_1.x+$this_1.w,$this_1.y+$this_1.h);if($this_1.type==1){$p.line($this_1.x,$this_1.y,$this_1.x+$this_1.w,$this_1.y)}}}if($this_1.type==3){$p.textFont($this_1.buttonFont,18)}else{$p.textFont($this_1.buttonFont,24)}$p.text($this_1.buttonText,$this_1.x+$this_1.w/2,$this_1.y+$this_1.h/2+8);$p.textAlign($p.LEFT);if(theAnimations!=null){theAnimations.animateEnd($this_1.$self)}}$p.addMethod($this_1,"display",display$0,false);function $constr_6(itype,ibuttonText,ix,iy,iw,ih){$superCstr();$this_1.buttonFont=$p.createFont("bitterregular.ttf",48);$this_1.buttonText=ibuttonText;$this_1.type=itype;$this_1.x=ix;$this_1.y=iy;$this_1.w=iw;$this_1.h=ih}function $constr(){if(arguments.length===6){$constr_6.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return BUTTON}();$p.BUTTON=BUTTON;var CHARSET=function(){function CHARSET(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.theCharSet=null;$this_1.charSetParts=null;$this_1.charSetFile=null;$this_1.tilesize=0;$this_1.defenseMap=null;function createParts$0(){if($this_1.theCharSet.width!=0){var l=$p.__int_cast($this_1.theCharSet.width/$this_1.tilesize);var b=$p.__int_cast($this_1.theCharSet.height/$this_1.tilesize);$this_1.charSetParts=$p.createJavaArray("$p.PImage",[l,b]);for(var i=0;i<l;i++){for(var j=0;j<b;j++){$this_1.charSetParts[i][j]=$this_1.theCharSet.get(i*$this_1.tilesize,j*$this_1.tilesize,$this_1.tilesize,$this_1.tilesize)}}}}$p.addMethod($this_1,"createParts",createParts$0,false);function getCharSet$0(){return $this_1.theCharSet}$p.addMethod($this_1,"getCharSet",getCharSet$0,false);function getCharSet$2_2(x,y){if($this_1.charSetParts!=null){return $this_1.charSetParts[x][y]}else{$this_1.$self.createParts();return $this_1.theCharSet.get(x*$this_1.tilesize,y*$this_1.tilesize,$this_1.tilesize,$this_1.tilesize)}}$p.addMethod($this_1,"getCharSet",getCharSet$2_2,false);function $constr_3(icharSetFile,idefenseMap,itilesize){$superCstr();$this_1.tilesize=itilesize;$this_1.defenseMap=idefenseMap;$this_1.charSetFile=icharSetFile;$this_1.theCharSet=$p.loadImage($this_1.defenseMap.mapPath+"/data/"+$this_1.charSetFile);if($this_1.tilesize!=-1){$this_1.$self.createParts()}}function $constr(){if(arguments.length===3){$constr_3.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return CHARSET}();$p.CHARSET=CHARSET;var CHARSETS=function(){function CHARSETS(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.charSets=null;$this_1.defenseMap=null;function addCharSet$2(charSetFile,tileSize){var foundCharSet=false;for(var i=0;i<$this_1.charSets.size();i++){var tempChar=$this_1.charSets.get(i);if(tempChar.charSetFile==charSetFile){foundCharSet=true;break}}if(foundCharSet==false){$this_1.charSets.add(new CHARSET(charSetFile,$this_1.defenseMap,tileSize))}}$p.addMethod($this_1,"addCharSet",addCharSet$2,false);function getCharSet$1(charSetFile){var temp=null;for(var i=0;i<$this_1.charSets.size();i++){var tempChar=$this_1.charSets.get(i);if(tempChar.charSetFile==charSetFile){temp=tempChar.getCharSet();break}}return temp}$p.addMethod($this_1,"getCharSet",getCharSet$1,false);function getCharSetPart$3(charSetFile,x,y){var temp=null;for(var i=0;i<$this_1.charSets.size();i++){var tempChar=$this_1.charSets.get(i);if(tempChar.charSetFile==charSetFile){temp=tempChar.getCharSet(x,y);break}}return temp}$p.addMethod($this_1,"getCharSetPart",getCharSetPart$3,false);function $constr_1(idefenseMap){$superCstr();$this_1.defenseMap=idefenseMap;$this_1.charSets=new $p.ArrayList}function $constr(){if(arguments.length===1){$constr_1.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return CHARSETS}();$p.CHARSETS=CHARSETS;var displayComparator=function(){function displayComparator(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}function compare$2(o1,o2){var position1=0;var position2=0;if($p.__instanceof(o1,TOWER)){var temp=o1;position1=(temp.position[1]+.5)*defenseMap.tileSize}else{var temp=o1;if(temp.enemyDied==false&&temp.enemyAlive==false&&(temp.moveDirection==1||temp.moveDirection==2)){position1=-50}else{position1=temp.position[1]}}if($p.__instanceof(o2,TOWER)){var temp=o2;position2=(temp.position[1]+.5)*defenseMap.tileSize}else{var temp=o2;if(temp.enemyDied==false&&temp.enemyAlive==false&&(temp.moveDirection==1||temp.moveDirection==2)){position2=-50}else{position2=temp.position[1]}}return $p.__int_cast(position2-position1)}$p.addMethod($this_1,"compare",compare$2,false);function $constr(){$superCstr()}$constr.apply(null,arguments)}displayComparator.$interfaces=[];return displayComparator}();$p.displayComparator=displayComparator;var enemyComparator=function(){function enemyComparator(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}function compare$2(enemy1,enemy2){var returnVar=0;returnVar=$p.__int_cast(enemy2.moveComplete-enemy1.moveComplete);return returnVar}$p.addMethod($this_1,"compare",compare$2,false);function $constr(){$superCstr()}$constr.apply(null,arguments)}enemyComparator.$interfaces=[];return enemyComparator}();$p.enemyComparator=enemyComparator;var CREDITSMENU=function(){function CREDITSMENU(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.menuFont=null;$this_1.backButton=null;function display$0(){$p.pushMatrix();$p.translate(0,-$p.height);$this_1.backButton.display();$p.textFont($this_1.menuFont,14);$p.fill(230);$p.textAlign($p.LEFT);$p.text("Developed and created by Kris Siepert.\n\nBased on Processing & ProcessingJS.\n\ncopyright (c) 2014 all rights reserved",70,100);$p.popMatrix()}$p.addMethod($this_1,"display",display$0,false);function mouseClicked$0(){if($this_1.backButton.mouseOverButton()==true){theMenu.changeScreen(0)}}$p.addMethod($this_1,"mouseClicked",mouseClicked$0,false);function $constr_0(){$superCstr();$this_1.menuFont=$p.createFont("bitterregular.ttf",48);$this_1.backButton=new BUTTON(0,"BACK",65,$p.height-65,110,26)}function $constr(){if(arguments.length===0){$constr_0.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return CREDITSMENU}();$p.CREDITSMENU=CREDITSMENU;var DISPLAY=function(){function DISPLAY(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.displayItems=null;$this_1.defenseMap=null;function display$0(){$this_1.displayItems.addAll($this_1.defenseMap.theTowers.towers);if($this_1.defenseMap.enemyWaves.started==true){$this_1.displayItems.addAll($this_1.defenseMap.enemyWaves.theWaves[$this_1.defenseMap.enemyWaves.currentWave].theWave);$this_1.defenseMap.enemyWaves.waveComplete();$this_1.defenseMap.enemyWaves.theWaves[$this_1.defenseMap.enemyWaves.currentWave].calcEnemyDistance()}Collections.sort($this_1.displayItems,new displayComparator);for(var i=$this_1.displayItems.size()-1;i>=0;i--){var temp=$this_1.displayItems.get(i);if($p.__instanceof(temp,TOWER)){var temp2=temp;temp2.display()}else{var temp2=temp;temp2.display()}}$this_1.displayItems.clear()}$p.addMethod($this_1,"display",display$0,false);function $constr_1(idefenseMap){$superCstr();$this_1.defenseMap=idefenseMap;$this_1.displayItems=new $p.ArrayList}function $constr(){if(arguments.length===1){$constr_1.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return DISPLAY}();$p.DISPLAY=DISPLAY;var ENEMY=function(){function ENEMY(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.moveComplete=0;$this_1.enemyTileSize=0;$this_1.animationCount=0;$this_1.animationSpeed=10;$this_1.moveSpeed=80;$this_1.moveVector=[0,0];$this_1.moveCount=0;$this_1.moveDirection=2;$this_1.moveState=1;$this_1.moveStateDirection=1;$this_1.position=[-16,-16];$this_1.charSet=null;$this_1.enemyIcon=null;$this_1.defenseMap=null;$this_1.healthBarOffset=-1;$this_1.startPoint=null;$this_1.endPoint=null;$this_1.wayPoints=null;$this_1.wayPointsSet=false;$this_1.wpPosition=0;$this_1.reachingEndpoint=false;$this_1.maxHealth=0;$this_1.health=0;$this_1.enemyAlive=true;$this_1.theGui=null;$this_1.money=1;$this_1.damage=0;$this_1.fireCount=0;$this_1.fireRate=1e3;$this_1.fireRadius=50;$this_1.freezeTime=0;$this_1.freezeCount=0;$this_1.freezeFactor=0;$this_1.freezeFactorTemp=1;$this_1.frozen=false;$this_1.charSetFile=null;$this_1.enemyDied=false;$this_1.dieCount=0;$this_1.dieStep=0;$this_1.dieTint=255;$this_1.gotHit=false;$this_1.hitCount=0;$this_1.hitStep=0;$this_1.hitCharset=null;$this_1.hitXValue=0;$this_1.towerHits=new $p.ArrayList;function display$0(){if($this_1.enemyDied==false&&$this_1.enemyAlive==false){if($this_1.dieStep<2){if($p.millis()-$this_1.dieCount>100){$this_1.dieCount=$p.millis();$this_1.dieStep++}}else{$this_1.dieTint-=15;if($this_1.dieTint<=15){$this_1.enemyDied=true}$p.tint(255,$this_1.dieTint)}$p.image($this_1.defenseMap.theCharSets.getCharSetPart($this_1.charSetFile,$this_1.dieStep,4+$this_1.moveDirection),$this_1.position[0]-$this_1.enemyTileSize/2,$this_1.position[1]-$this_1.enemyTileSize/2-($this_1.enemyTileSize/2-$this_1.defenseMap.tileSize/2)-$this_1.defenseMap.tileSize/4);$p.noTint()}if($this_1.wayPointsSet==true&&$this_1.enemyAlive==true){$this_1.freezeFactorTemp=1;if($this_1.freezeCount>$p.millis()-$this_1.freezeTime){$this_1.freezeFactorTemp=$this_1.freezeFactor;if(globalPlatform!=2){$p.tint(0,153,204)}}else{$this_1.frozen=false}if($this_1.damage>0){if($p.millis()-$this_1.fireCount>=$this_1.fireRate/(globalSpeed*$this_1.freezeFactorTemp)){$this_1.defenseMap.theTowers.checkTowers($p.__int_cast($this_1.position[0]),$p.__int_cast($this_1.position[1]),$this_1.fireRadius,$this_1.damage);$this_1.fireCount=$p.millis()}}if($p.millis()-$this_1.animationCount>=1e3/($this_1.animationSpeed*globalSpeed*$this_1.freezeFactorTemp)){$this_1.moveState+=$this_1.moveStateDirection;if($this_1.moveState==3||$this_1.moveState==-1){$this_1.moveState=1;$this_1.moveStateDirection*=-1}$this_1.animationCount=$p.millis()}$this_1.$self.checkWP();var timeSinceLastMove=$p.millis()-$this_1.moveCount;var movementInPixels=$this_1.moveSpeed/1e3*timeSinceLastMove;$this_1.position[0]+=$this_1.moveVector[0]*globalSpeed*$this_1.freezeFactorTemp*movementInPixels;$this_1.position[1]+=$this_1.moveVector[1]*globalSpeed*$this_1.freezeFactorTemp*movementInPixels;$this_1.moveComplete+=$p.abs($this_1.moveVector[0]*globalSpeed*$this_1.freezeFactorTemp*movementInPixels)+$p.abs($this_1.moveVector[1]*globalSpeed*$this_1.freezeFactorTemp*movementInPixels);$this_1.moveCount=$p.millis();$this_1.defenseMap.theAnimations.animate($this_1.$self);$p.image($this_1.defenseMap.theCharSets.getCharSetPart($this_1.charSetFile,$this_1.moveState,$this_1.moveDirection),$this_1.position[0]-$this_1.enemyTileSize/2,$this_1.position[1]-$this_1.enemyTileSize/2-($this_1.enemyTileSize/2-$this_1.defenseMap.tileSize/2)-$this_1.defenseMap.tileSize/4);$p.noTint()}if($this_1.gotHit==true){var hitImg=null;if($p.millis()-$this_1.hitCount<80){hitImg=$this_1.defenseMap.theCharSets.getCharSetPart($this_1.hitCharset,$this_1.hitXValue,1)}else if($p.millis()-$this_1.hitCount<160){hitImg=$this_1.defenseMap.theCharSets.getCharSetPart($this_1.hitCharset,$this_1.hitXValue+1,1)}else if($p.millis()-$this_1.hitCount<240){hitImg=$this_1.defenseMap.theCharSets.getCharSetPart($this_1.hitCharset,$this_1.hitXValue+2,1)}else{$this_1.gotHit=false}$p.imageMode($p.CENTER);if(hitImg!=null){$p.image(hitImg,$this_1.position[0],$this_1.position[1]-($this_1.enemyTileSize/2-$this_1.defenseMap.tileSize/2))}$p.imageMode($p.CORNER)}}$p.addMethod($this_1,"display",display$0,false);function displayGui$0(){if($this_1.wayPointsSet==true&&$this_1.enemyAlive==true){if($this_1.health<$this_1.maxHealth){$p.stroke(50);$p.fill(204,0,51);$p.rect($this_1.position[0]-$this_1.enemyTileSize/2+$this_1.enemyTileSize*.25,$this_1.position[1]-$this_1.enemyTileSize/2-$this_1.enemyTileSize*.25-($this_1.enemyTileSize/2-$this_1.defenseMap.tileSize/2)+$this_1.healthBarOffset,$this_1.enemyTileSize*.5,3);$p.fill(0,204,51);$p.rect($this_1.position[0]-$this_1.enemyTileSize/2+$this_1.enemyTileSize*.25,$this_1.position[1]-$this_1.enemyTileSize/2-$this_1.enemyTileSize*.25-($this_1.enemyTileSize/2-$this_1.defenseMap.tileSize/2)+$this_1.healthBarOffset,$this_1.enemyTileSize*.5*($this_1.health/$this_1.maxHealth),3)}}}$p.addMethod($this_1,"displayGui",displayGui$0,false);function setWaypoints$3(istartPoint,iendPoint,iwayPoints){$this_1.startPoint=istartPoint;$this_1.endPoint=iendPoint;$this_1.wayPoints=iwayPoints;$this_1.$self.spawnEnemy();$this_1.$self.calculateMoveVector();$this_1.$self.calcHealthbarOffset();$this_1.wayPointsSet=true;$this_1.moveCount=$p.millis()}$p.addMethod($this_1,"setWaypoints",setWaypoints$3,false);function spawnEnemy$0(){$this_1.reachingEndpoint=false;$this_1.position[1]=$this_1.startPoint[1];$this_1.position[0]=$this_1.startPoint[0]-$this_1.enemyTileSize;$this_1.wpPosition=-1;$this_1.moveCount=$p.millis()}$p.addMethod($this_1,"spawnEnemy",spawnEnemy$0,false);

function checkWP$0(){var nextPoint=null;if($this_1.wpPosition>=$this_1.wayPoints.length){nextPoint=$p.createJavaArray("int",[2]);nextPoint[1]=$this_1.endPoint[1];nextPoint[0]=$this_1.endPoint[0]+$p.parseInt($this_1.enemyTileSize);$this_1.reachingEndpoint=true}else{nextPoint=$this_1.wayPoints[$this_1.wpPosition]}if($this_1.moveVector[0]<0){if($this_1.position[0]<=nextPoint[0]){$this_1.position[0]=nextPoint[0];if($this_1.reachingEndpoint==true){$this_1.$self.gotToEnd()}$this_1.$self.calculateMoveVector()}}else if($this_1.moveVector[0]>0){if($this_1.position[0]>=nextPoint[0]){$this_1.position[0]=nextPoint[0];if($this_1.reachingEndpoint==true){$this_1.$self.gotToEnd()}$this_1.$self.calculateMoveVector()}}else if($this_1.moveVector[1]<0){if($this_1.position[1]<=nextPoint[1]){$this_1.position[1]=nextPoint[1];if($this_1.reachingEndpoint==true){$this_1.$self.gotToEnd()}$this_1.$self.calculateMoveVector()}}else if($this_1.moveVector[1]>0){if($this_1.position[1]>=nextPoint[1]){$this_1.position[1]=nextPoint[1];if($this_1.reachingEndpoint==true){$this_1.$self.gotToEnd()}$this_1.$self.calculateMoveVector()}}}$p.addMethod($this_1,"checkWP",checkWP$0,false);function calculateMoveVector$0(){$this_1.wpPosition++;$this_1.moveVector[0]=0;$this_1.moveVector[1]=0;var nextPoint=null;if($this_1.wpPosition>=$this_1.wayPoints.length){nextPoint=$this_1.endPoint}else{nextPoint=$this_1.wayPoints[$this_1.wpPosition]}if(nextPoint[0]-$this_1.position[0]>0+$this_1.freezeFactorTemp){$this_1.moveVector[0]=1;$this_1.moveDirection=2}else if(nextPoint[0]-$this_1.position[0]<0-$this_1.freezeFactorTemp){$this_1.moveVector[0]=-1;$this_1.moveDirection=1}if(nextPoint[1]-$this_1.position[1]>0+$this_1.freezeFactorTemp){$this_1.moveVector[1]=1;$this_1.moveDirection=0}else if(nextPoint[1]-$this_1.position[1]<0-$this_1.freezeFactorTemp){$this_1.moveVector[1]=-1;$this_1.moveDirection=3}}$p.addMethod($this_1,"calculateMoveVector",calculateMoveVector$0,false);function gotToEnd$0(){$this_1.defenseMap.theGui.enemyReachedEnd();$this_1.enemyAlive=false}$p.addMethod($this_1,"gotToEnd",gotToEnd$0,false);function hitByTower$2(damage,freeze){$this_1.$self.getDamageByTower(damage,freeze)}$p.addMethod($this_1,"hitByTower",hitByTower$2,false);function hitByTower$4_2(damage,freeze,tower,multiplier){var hitDamage=damage;var foundTower=false;for(var i=0;i<$this_1.towerHits.size();i++){var temp=$this_1.towerHits.get(i);if($p.__equals(temp.tower,tower)){foundTower=true;hitDamage=temp.getDamage();break}}if(foundTower==false){$this_1.towerHits.add(new towerHit(tower,damage,multiplier))}$this_1.$self.getDamageByTower(hitDamage,freeze)}$p.addMethod($this_1,"hitByTower",hitByTower$4_2,false);function getDamageByTower$2(damage,freeze){if(freeze>0){$this_1.freezeCount=$p.millis();$this_1.freezeFactor=freeze;$this_1.frozen=true;$this_1.freezeTime=2500}$this_1.health-=damage;if($this_1.health<0){$this_1.moveComplete=999999999;$this_1.enemyAlive=false;$this_1.dieCount=$p.millis();$this_1.defenseMap.theGui.enemyKilled($this_1.money)}}$p.addMethod($this_1,"getDamageByTower",getDamageByTower$2,false);function getPosition$0(){return[$p.__int_cast($this_1.position[0]),$p.__int_cast($this_1.position[1])]}$p.addMethod($this_1,"getPosition",getPosition$0,false);function alive$0(){return $this_1.enemyAlive}$p.addMethod($this_1,"alive",alive$0,false);function hitAnimation$2(ihitCharset,x){$this_1.gotHit=true;$this_1.hitCount=$p.millis();$this_1.hitStep=0;$this_1.hitXValue=x;$this_1.hitCharset=ihitCharset}$p.addMethod($this_1,"hitAnimation",hitAnimation$2,false);function calcEnemyPosInFuture$1(time){var returnPosition=$p.createJavaArray("float",[2]);var movementInPixels=$this_1.moveSpeed/1e3*time;returnPosition[0]=$this_1.position[0]+$this_1.moveVector[0]*globalSpeed*$this_1.freezeFactorTemp*movementInPixels;returnPosition[1]=$this_1.position[1]+$this_1.moveVector[1]*globalSpeed*$this_1.freezeFactorTemp*movementInPixels;return returnPosition}$p.addMethod($this_1,"calcEnemyPosInFuture",calcEnemyPosInFuture$1,false);function calcHealthbarOffset$0(){var tempCharSet=$this_1.defenseMap.theCharSets.getCharSetPart($this_1.charSetFile,1,0);tempCharSet.loadPixels();for(var y=0;y<tempCharSet.height;y++){if($this_1.healthBarOffset==-1){for(var x=0;x<tempCharSet.width;x++){var loc=x+y*tempCharSet.width;if($p.alpha(tempCharSet.pixels.getPixel(loc))!=0){$this_1.healthBarOffset=y-1;break}}}else{break}}}$p.addMethod($this_1,"calcHealthbarOffset",calcHealthbarOffset$0,false);function $constr_10(icharSetFile,ienemyIcon,ienemyTileSize,imaxHealth,imoveSpeed,imoney,idamage,ianimationSpeed,itheGui,idefenseMap){$superCstr();$this_1.charSetFile=icharSetFile;$this_1.defenseMap=idefenseMap;$this_1.defenseMap.theCharSets.addCharSet(icharSetFile,ienemyTileSize);$this_1.charSet=$this_1.defenseMap.theCharSets.getCharSet(icharSetFile);$this_1.defenseMap.theCharSets.addCharSet(ienemyIcon,-1);$this_1.enemyIcon=$this_1.defenseMap.theCharSets.getCharSet(ienemyIcon);$this_1.health=imaxHealth*$this_1.defenseMap.difficulty;$this_1.maxHealth=imaxHealth*$this_1.defenseMap.difficulty;$this_1.enemyTileSize=ienemyTileSize;$this_1.theGui=itheGui;$this_1.moveSpeed=imoveSpeed;$this_1.money=imoney;$this_1.damage=idamage*$this_1.defenseMap.difficulty;$this_1.animationSpeed=ianimationSpeed;$this_1.moveCount=$p.millis()}function $constr(){if(arguments.length===10){$constr_10.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return ENEMY}();$p.ENEMY=ENEMY;var towerHit=function(){function towerHit(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.tower=null;$this_1.count=1;$this_1.damage=0;$this_1.multiplier=0;function getDamage$0(){var returnVar=$this_1.damage;for(var i=0;i<$this_1.count;i++){returnVar*=$this_1.multiplier}$this_1.count++;return returnVar}$p.addMethod($this_1,"getDamage",getDamage$0,false);function $constr_3(itower,idamage,imultiplier){$superCstr();$this_1.tower=itower;$this_1.damage=idamage;$this_1.multiplier=imultiplier}function $constr(){if(arguments.length===3){$constr_3.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return towerHit}();$p.towerHit=towerHit;var GUI=function(){function GUI(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.moneyImg=null;$this_1.lifeImg=null;$this_1.hudBottom=null;$this_1.hudTop=null;$this_1.hudPlay=null;$this_1.hudBuild=null;$this_1.hudMenu=null;$this_1.yesButton=null;$this_1.noButton=null;$this_1.guiFont=null;$this_1.money=0;$this_1.lifes=0;$this_1.defenseMap=null;$this_1.guiScale=1;$this_1.menuScale=1;function display$0(){$p.pushMatrix();$p.scale($this_1.guiScale);if(antiAliasing==true&&globalPlatform==1){$p.tint(255)}$p.image($this_1.hudTop,0,0);$p.image($this_1.moneyImg,8,9);$p.noTint();$p.textFont($this_1.guiFont,15);$p.fill(0,180);$p.text($this_1.money,27,24);$p.fill(4294965448);$p.text($this_1.money,26,23);if(antiAliasing==true&&globalPlatform==1){$p.tint(255)}$p.image($this_1.lifeImg,70,11);$p.noTint();$p.fill(0,180);$p.text($this_1.lifes,89,24);$p.fill(4294965448);$p.text($this_1.lifes,88,23);$p.popMatrix();$p.pushMatrix();$p.translate(-(($p.width-400)*($this_1.guiScale-1))-(400*$this_1.guiScale-400),-(($p.height-50)*($this_1.guiScale-1))-(50*$this_1.guiScale-50));$p.scale($this_1.guiScale);$p.imageMode($p.CORNER);if(antiAliasing==true&&globalPlatform==1){$p.tint(255)}$p.image($this_1.hudBottom,$p.width-400,$p.height-50);$p.noTint();$p.textFont($this_1.guiFont,14);$p.textAlign($p.LEFT);$p.fill(0,180);$p.text("Wave "+($this_1.defenseMap.enemyWaves.currentWave+1)+" of "+$this_1.defenseMap.enemyWaves.theWaves.length+" - next wave:",$p.width-357,$p.height-7);$p.fill(4294965448);$p.text("Wave "+($this_1.defenseMap.enemyWaves.currentWave+1)+" of "+$this_1.defenseMap.enemyWaves.theWaves.length+" - next wave:",$p.width-358,$p.height-8);$p.textAlign($p.LEFT);$this_1.defenseMap.enemyWaves.nextEnemies($p.width-165,$p.height-30);$p.popMatrix();if($this_1.defenseMap.backToMenu==true){$p.fill(0,180);$p.noStroke();$p.rectMode($p.CENTER);$p.rect($p.width/2,$p.height/2,$p.width/3,$p.height/3,20);$p.textFont($this_1.guiFont,18);$p.fill(255);$p.textAlign($p.CENTER);$p.text("Do you really want to quit\nand go back to the menu?",$p.width/2,$p.height/2-40);$this_1.yesButton.display();$this_1.noButton.display()}$p.pushMatrix();$p.translate(-(13*$this_1.guiScale-13),-(($p.height-13)*$this_1.guiScale-($p.height-13)));$p.scale($this_1.guiScale);if(antiAliasing==true&&globalPlatform==1){$p.tint(255)}$p.image($this_1.hudPlay,13,$p.height-49);$p.image($this_1.hudBuild,65,$p.height-47);$p.image($this_1.hudMenu,105,$p.height-47);$p.noTint();$p.popMatrix()}$p.addMethod($this_1,"display",display$0,false);function enemyKilled$1(plusmoney){$this_1.money+=$p.parseInt(plusmoney)}$p.addMethod($this_1,"enemyKilled",enemyKilled$1,false);function enemyReachedEnd$0(){$this_1.lifes--;if($this_1.lifes==0){$this_1.defenseMap.theActions.loseGame()}}$p.addMethod($this_1,"enemyReachedEnd",enemyReachedEnd$0,false);function $constr_5(startmoney,startlifes,iguiScale,imenuScale,idefenseMap){$superCstr();$this_1.money=startmoney;$this_1.lifes=startlifes;$this_1.guiScale=iguiScale;$this_1.menuScale=imenuScale;$this_1.hudBottom=$p.loadImage("hud_bottom.png");$this_1.hudTop=$p.loadImage("hud_top.png");$this_1.moneyImg=$p.loadImage("money.png");$this_1.lifeImg=$p.loadImage("life.png");$this_1.hudPlay=$p.loadImage("hud_pause.png");$this_1.hudBuild=$p.loadImage("build.png");$this_1.guiFont=$p.createFont("Arial",48);$this_1.hudMenu=$p.loadImage("menu.png");$this_1.defenseMap=idefenseMap;$this_1.yesButton=new BUTTON(0,"YES",$p.width/2-120,$p.height/2+40,60,26);$this_1.noButton=new BUTTON(0,"NO",$p.width/2+60,$p.height/2+40,60,26)}function $constr(){if(arguments.length===5){$constr_5.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return GUI}();$p.GUI=GUI;var INPUT=function(){function INPUT(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.defenseMap=null;$this_1.buildMenu=null;$this_1.towerMenu=null;$this_1.justPaused=false;function zoom$1(z){$this_1.defenseMap.zoom+=z;if($this_1.defenseMap.zoom<1){$this_1.defenseMap.zoom=1}if($this_1.defenseMap.zoom>1.5){$this_1.defenseMap.zoom=1.5}$this_1.$self.checkBorders()}$p.addMethod($this_1,"zoom",zoom$1,false);function scroll$2(x,y){$this_1.defenseMap.centerX+=x;$this_1.defenseMap.centerY+=y;$this_1.$self.checkBorders()}$p.addMethod($this_1,"scroll",scroll$2,false);function checkBorders$0(){if($this_1.defenseMap.centerX>$p.width/2*($this_1.defenseMap.zoom-1)){$this_1.defenseMap.centerX=$p.width/2*($this_1.defenseMap.zoom-1)}if($this_1.defenseMap.centerX<$p.width-$this_1.defenseMap.mapWidth*$this_1.defenseMap.zoom+$p.width/2*($this_1.defenseMap.zoom-1)){$this_1.defenseMap.centerX=$p.width-$this_1.defenseMap.mapWidth*$this_1.defenseMap.zoom+$p.width/2*($this_1.defenseMap.zoom-1)}if($this_1.defenseMap.centerY>$p.height/2*($this_1.defenseMap.zoom-1)){$this_1.defenseMap.centerY=$p.height/2*($this_1.defenseMap.zoom-1)}if($this_1.defenseMap.centerY<$p.height-$this_1.defenseMap.mapHeight*$this_1.defenseMap.zoom+$p.height/2*($this_1.defenseMap.zoom-1)){$this_1.defenseMap.centerY=$p.height-$this_1.defenseMap.mapHeight*$this_1.defenseMap.zoom+$p.height/2*($this_1.defenseMap.zoom-1)}}$p.addMethod($this_1,"checkBorders",checkBorders$0,false);function mapToWinX$1(x){return $p.__int_cast((x-$p.width/2)*$this_1.defenseMap.zoom+$p.width/2)}$p.addMethod($this_1,"mapToWinX",mapToWinX$1,false);function mapToWinY$1(y){return $p.__int_cast((y-$p.height/2)*$this_1.defenseMap.zoom+$p.height/2)}$p.addMethod($this_1,"mapToWinY",mapToWinY$1,false);function winToMapX$1(x){return $p.__int_cast(x+$p.width/2*$this_1.defenseMap.zoom-$p.width/2-$this_1.defenseMap.centerX)}$p.addMethod($this_1,"winToMapX",winToMapX$1,false);function winToMapY$1(y){return $p.__int_cast(y+$p.height/2*$this_1.defenseMap.zoom-$p.height/2-$this_1.defenseMap.centerY)}$p.addMethod($this_1,"winToMapY",winToMapY$1,false);function mouseClick$0(){if(mouseXp<=49*hudScale&&mouseXp>=13&&mouseYp>=$p.height-49*hudScale&&mouseYp<=$p.height-13){if($this_1.defenseMap.pause==false){$this_1.defenseMap.theGui.hudPlay=$p.loadImage("hud_play.png");globalSpeed=0;$this_1.defenseMap.pause=true}else{$this_1.defenseMap.theGui.hudPlay=$p.loadImage("hud_pause.png");globalSpeed=1;$this_1.defenseMap.pause=false;$this_1.justPaused=true}}if(mouseXp<=85*hudScale&&mouseXp>=62*hudScale&&mouseYp>=$p.height-47*hudScale&&mouseYp<=$p.height-13){if($this_1.defenseMap.showBuildAreas==true){$this_1.defenseMap.showBuildAreas=false}else{$this_1.defenseMap.showBuildAreas=true}}else{$this_1.defenseMap.showBuildAreas=false}if(mouseXp<=135*hudScale&&mouseXp>=105*hudScale&&mouseYp>=$p.height-47*hudScale&&mouseYp<=$p.height-13){globalSpeed=0;$this_1.defenseMap.pause=true;$this_1.defenseMap.backToMenu=true}if($this_1.defenseMap.backToMenu==true){if($this_1.defenseMap.theGui.yesButton.mouseOverButton()==true){$this_1.defenseMap.backToMenuApply=true}else if($this_1.defenseMap.theGui.noButton.mouseOverButton()==true){$this_1.defenseMap.backToMenu=false;globalSpeed=1;$this_1.defenseMap.pause=false;$this_1.justPaused=true}}if($this_1.defenseMap.defeated==false&&$this_1.defenseMap.pause==false&&$this_1.justPaused==false){var j=$this_1.defenseMap.theTowers.isTower($this_1.$self.winToMapX(mouseXp),$this_1.$self.winToMapY(mouseYp));if($this_1.buildMenu!=null){var i=$this_1.buildMenu.mouseOver($this_1.$self.winToMapX(mouseXp),$this_1.$self.winToMapY(mouseYp));if(i!=-1){$this_1.defenseMap.theTowers.addTower(i,$this_1.buildMenu.bmPosition[0],$this_1.buildMenu.bmPosition[1]);$this_1.buildMenu=null}else{$this_1.buildMenu=null}}else{if($this_1.towerMenu!=null){var k=$this_1.towerMenu.mouseOver($this_1.$self.winToMapX(mouseXp),$this_1.$self.winToMapY(mouseYp));if(k!=-1){switch(k){case 2:$this_1.defenseMap.theTowers.sellTower($this_1.towerMenu.tmActive);$this_1.towerMenu.closeMenu();$this_1.towerMenu=null;break;case 0:$this_1.towerMenu.tmActive.repairTower();break;case 1:$this_1.towerMenu.tmActive.updateTower();$this_1.towerMenu.tmInfo.updateDesc($this_1.towerMenu.tmActive.getDescription());break}}else{$this_1.towerMenu.closeMenu();$this_1.towerMenu=null}}else if(j!=-1){$this_1.towerMenu=new TOWERMENU($this_1.defenseMap,j);$this_1.defenseMap.theAnimations.addAnimation($this_1.towerMenu,[[1,$this_1.$self.mapToWinX(($this_1.towerMenu.bmPosition[0]+.5)*$this_1.defenseMap.tileSize),0,180,0,0],[2,$this_1.$self.mapToWinY(($this_1.towerMenu.bmPosition[1]+.5)*$this_1.defenseMap.tileSize),0,180,0,0],[0,0,1,180,0,0]]);if(globalPlatform!=2){$this_1.defenseMap.theAnimations.addAnimation($this_1.defenseMap.theTowers.getTower(j),[[6,255,0,500,0,1]])}}else if($this_1.defenseMap.canBuild($this_1.$self.winToMapX(mouseXp),$this_1.$self.winToMapY(mouseYp))==true){$this_1.buildMenu=new BUILDMENU($this_1.defenseMap);$this_1.defenseMap.theAnimations.addAnimation($this_1.buildMenu,[[1,$this_1.$self.mapToWinX(($this_1.buildMenu.bmPosition[0]+.5)*$this_1.defenseMap.tileSize),0,180,0,0],[2,$this_1.$self.mapToWinY(($this_1.buildMenu.bmPosition[1]+.5)*$this_1.defenseMap.tileSize),0,180,0,0],[0,0,1,180,0,0]])}}}$this_1.justPaused=false}$p.addMethod($this_1,"mouseClick",mouseClick$0,false);function display$0(){$p.pushMatrix();$p.translate($this_1.defenseMap.centerX,$this_1.defenseMap.centerY);if($this_1.buildMenu!=null){$this_1.buildMenu.display()}if($this_1.towerMenu!=null){$this_1.towerMenu.display()}$p.popMatrix()}$p.addMethod($this_1,"display",display$0,false);function $constr_1(idefenseMap){$superCstr();$this_1.defenseMap=idefenseMap}function $constr(){if(arguments.length===1){$constr_1.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return INPUT}();$p.INPUT=INPUT;var MAINMENU=function(){function MAINMENU(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.backgroundImage=null;$this_1.playButton=null;$this_1.creditsButton=null;$this_1.exitButton=null;$this_1.optionsButton=null;$this_1.buttonDistance=($p.width-130*4)/5;function display$0(){theAnimations.animate($this_1.$self);$p.imageMode($p.CENTER);$p.image($this_1.backgroundImage,$p.width/2,$this_1.backgroundImage.height/2+40);$this_1.playButton.display();if(globalPlatform!=2){$this_1.exitButton.display()}$this_1.creditsButton.display();$this_1.optionsButton.display();theAnimations.animateEnd($this_1.$self)}$p.addMethod($this_1,"display",display$0,false);function mouseClicked$0(){if($this_1.playButton.mouseOverButton()==true){theMenu.changeScreen(1)}else if($this_1.creditsButton.mouseOverButton()==true){theMenu.changeScreen(-1)}else if($this_1.optionsButton.mouseOverButton()==true){theMenu.changeScreen(-2)}else if(globalPlatform!=2){if($this_1.exitButton.mouseOverButton()==true){$p.exit()}}}$p.addMethod($this_1,"mouseClicked",mouseClicked$0,false);function $constr_0(){$superCstr();$this_1.backgroundImage=$p.loadImage("logo_dm.png");$this_1.playButton=new BUTTON(0,"PLAY",$p.parseInt($this_1.buttonDistance),$p.height-65,130,26);$this_1.creditsButton=new BUTTON(0,"CREDITS",$p.parseInt($this_1.buttonDistance*2)+130,$p.height-65,130,26);if(globalPlatform!=2){$this_1.exitButton=new BUTTON(0,"EXIT",$p.parseInt($this_1.buttonDistance*4)+130*3,$p.height-65,130,26)}$this_1.optionsButton=new BUTTON(0,"OPTIONS",$p.parseInt($this_1.buttonDistance*3)+130*2,$p.height-65,130,26);theAnimations.addAnimation($this_1.playButton,[[2,200,0,800,1e3,0]]);theAnimations.addAnimation($this_1.creditsButton,[[2,200,0,800,1100,0]]);if(globalPlatform!=2){theAnimations.addAnimation($this_1.exitButton,[[2,200,0,800,1300,0]])}theAnimations.addAnimation($this_1.optionsButton,[[2,200,0,800,1200,0]]);theAnimations.addAnimation($this_1.$self,[[3,0,255,1e3,0,0]])}function $constr(){if(arguments.length===0){$constr_0.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return MAINMENU}();$p.MAINMENU=MAINMENU;var MENU=function(){function MENU(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.theOptionsMenu=null;$this_1.theCreditsMenu=null;$this_1.theMainMenu=null;$this_1.thePlayMenu=null;$this_1.theAfterMatchMenu=null;$this_1.screen=0;$this_1.screenTemp=0;$this_1.screenChanging=false;function display$0(){theAnimations.animate($this_1.$self);if($this_1.screenChanging==true){$this_1.screenChanging=false;$this_1.screen=$this_1.screenTemp}$p.pushMatrix();$p.translate(0,-($p.height*$this_1.screen));$p.background(0);if($this_1.theMainMenu!=null){$this_1.theMainMenu.display()}if($this_1.theCreditsMenu!=null){$this_1.theCreditsMenu.display()}if($this_1.thePlayMenu!=null){$this_1.thePlayMenu.display()}if($this_1.theOptionsMenu!=null){$this_1.theOptionsMenu.display()}if($this_1.theAfterMatchMenu!=null){$this_1.theAfterMatchMenu.display()}$p.popMatrix();theAnimations.animateEnd($this_1.$self)}$p.addMethod($this_1,"display",display$0,false);function mouseClicked$0(){if($this_1.screen==-1){$this_1.theCreditsMenu.mouseClicked()}if($this_1.screen==0){$this_1.theMainMenu.mouseClicked()}if($this_1.screen==1){$this_1.thePlayMenu.mouseClicked()}if($this_1.screen==2){$this_1.theAfterMatchMenu.mouseClicked()}if($this_1.screen==-2){$this_1.theOptionsMenu.mouseClicked()}}$p.addMethod($this_1,"mouseClicked",mouseClicked$0,false);function scroll$1(y){if($this_1.thePlayMenu!=null&&$this_1.screen==1){$this_1.thePlayMenu.scroll(y)}}$p.addMethod($this_1,"scroll",scroll$1,false);function changeScreen$1(i){$this_1.thePlayMenu.centerY=0;var y1=$p.parseInt($p.height*(i-$this_1.screen));$this_1.screenTemp=i;$this_1.screenChanging=true;theAnimations.addAnimation($this_1.$self,[[2,y1,0,400,0,0]])}$p.addMethod($this_1,"changeScreen",changeScreen$1,false);function $constr_2(iscreen,wonTheGame){$superCstr();$this_1.theMainMenu=new MAINMENU;$this_1.thePlayMenu=new PLAYMENU;$this_1.theCreditsMenu=new CREDITSMENU;$this_1.theOptionsMenu=new OPTIONSMENU;$this_1.theAfterMatchMenu=new AFTERMATCH(wonTheGame);$this_1.screen=iscreen}function $constr(){if(arguments.length===2){$constr_2.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return MENU}();$p.MENU=MENU;var OPTIONSMENU=function(){function OPTIONSMENU(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.menuFont=null;$this_1.backButton=null;$this_1.hqButton=null;$this_1.fpsButton=null;$this_1.aaButton=null;function display$0(){$p.pushMatrix();$p.translate(0,-2*$p.height);$this_1.backButton.display();$this_1.hqButton.display();$this_1.aaButton.display();$this_1.fpsButton.display();$p.textFont($this_1.menuFont,14);$p.fill(230);$p.text("Click to enable high quality graphics:\nthis costs a lot of performance.",260,70);$p.text("Click to enable Anti Aliasing:\nthis costs even more performance.",260,145);$p.text("Click to show the current framerate\nper second.",260,220);$p.popMatrix()}$p.addMethod($this_1,"display",display$0,false);function mouseClicked$0(){if($this_1.backButton.mouseOverButton()==true){theMenu.changeScreen(0)}else if($this_1.hqButton.mouseOverButton()==true){if($this_1.hqButton.isActive==false){$this_1.hqButton.isActive=true;highGraphicsQuality=true}else{$this_1.hqButton.isActive=false;highGraphicsQuality=false}}else if($this_1.aaButton.mouseOverButton()==true){if($this_1.aaButton.isActive==false){$this_1.aaButton.isActive=true;antiAliasing=true}else{$this_1.aaButton.isActive=false;antiAliasing=false}}else if($this_1.fpsButton.mouseOverButton()==true){if($this_1.fpsButton.isActive==false){$this_1.fpsButton.isActive=true;showFps=true}else{$this_1.fpsButton.isActive=false;showFps=false}}}$p.addMethod($this_1,"mouseClicked",mouseClicked$0,false);function $constr_0(){$superCstr();$this_1.menuFont=$p.createFont("bitterregular.ttf",48);$this_1.backButton=new BUTTON(0,"BACK",65,$p.height-65,110,26);$this_1.hqButton=new BUTTON(1,"HQ GRAPHICS",65,65,160,26);$this_1.aaButton=new BUTTON(1,"ENABLE AA",65,140,160,26);$this_1.fpsButton=new BUTTON(1,"SHOW FPS",65,215,160,26)}function $constr(){if(arguments.length===0){$constr_0.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return OPTIONSMENU}();$p.OPTIONSMENU=OPTIONSMENU;var PLAYMENU=function(){function PLAYMENU(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.easyButton=null;$this_1.normalButton=null;$this_1.hardButton=null;$this_1.backButton=null;$this_1.playGameButton=null;$this_1.mapButtons=null;$this_1.customMapButtons=null;$this_1.buttonDistance=($p.width-110*3)/4;$this_1.hardness=2;$this_1.menuFont=null;$this_1.xmlData=null;$this_1.theMaps=null;$this_1.customMaps=null;$this_1.theMapIcons=null;$this_1.customMapIcons=null;$this_1.posTopMaps=120;$this_1.mapsWidth=400;$this_1.mapPicked=-1;$this_1.customMapPicked=-1;$this_1.centerY=0;function display$0(){$p.pushMatrix();$p.translate(0,$p.height);$p.pushMatrix();$p.translate(0,$this_1.centerY);$p.fill(255,190);$p.textFont($this_1.menuFont,18);$p.text("Standard maps",$p.width/2-$this_1.mapsWidth/2,$this_1.posTopMaps-5);$p.stroke(4294499778);$p.line($p.width/2-$this_1.mapsWidth/2,$this_1.posTopMaps,$p.width/2+$this_1.mapsWidth/2,$this_1.posTopMaps);$p.stroke(4280619010);$p.line($p.width/2-$this_1.mapsWidth/2,$this_1.posTopMaps+1,$p.width/2+$this_1.mapsWidth/2,$this_1.posTopMaps+1);for(var i=0;i<$this_1.mapButtons.length;i++){$this_1.mapButtons[i].display();if($this_1.theMaps[0][i][2]!=""){$p.image($this_1.theMapIcons[i],$p.width/2-$this_1.mapsWidth/2,$this_1.posTopMaps+i*60+30)}$p.textFont($this_1.menuFont,12);$p.textAlign($p.CENTER);$p.text($this_1.theMaps[0][i][3],$p.width/2-$this_1.mapsWidth/2+150,$this_1.posTopMaps+i*60+70)}if(globalPlatform==0&&developerMode==true){$p.fill(255,190);$p.textFont($this_1.menuFont,18);$p.textAlign($p.LEFT);$p.text("Custom maps",$p.width/2-$this_1.mapsWidth/2,$this_1.posTopMaps-5+$this_1.mapButtons.length*60+80);$p.stroke(4294499778);$p.line($p.width/2-$this_1.mapsWidth/2,$this_1.posTopMaps+$this_1.mapButtons.length*60+80,$p.width/2+$this_1.mapsWidth/2,$this_1.posTopMaps+$this_1.mapButtons.length*60+80);$p.stroke(4280619010);$p.line($p.width/2-$this_1.mapsWidth/2,$this_1.posTopMaps+$this_1.mapButtons.length*60+81,$p.width/2+$this_1.mapsWidth/2,$this_1.posTopMaps+$this_1.mapButtons.length*60+81);if($this_1.customMapButtons.size()==0){$p.text("no maps availabe",$p.width/2-$this_1.mapsWidth/2,$this_1.posTopMaps-5+$this_1.mapButtons.length*60+120)}else{for(var i=0;i<$this_1.customMapButtons.size();i++){var tempButton=$this_1.customMapButtons.get(i);tempButton.display();var tempMap=$this_1.customMaps.get(i);$p.textFont($this_1.menuFont,12);$p.textAlign($p.CENTER);$p.text(tempMap[3],$p.width/2-$this_1.mapsWidth/2+150,$this_1.posTopMaps+$this_1.mapButtons.length*60+80+i*60+70)}}}$p.popMatrix();$p.fill(0);$p.noStroke();$this_1.easyButton.display();$this_1.normalButton.display();$this_1.hardButton.display();$this_1.backButton.display();$this_1.playGameButton.display();$p.popMatrix()}$p.addMethod($this_1,"display",display$0,false);function scroll$1(y){$this_1.centerY+=$p.__int_cast(y);if($this_1.centerY>0){$this_1.centerY=0}for(var i=0;i<$this_1.mapButtons.length;i++){$this_1.mapButtons[i].scrollOffset=$this_1.centerY}for(var i=0;i<$this_1.customMapButtons.size();i++){var temp=$this_1.customMapButtons.get(i);temp.scrollOffset=$this_1.centerY}}$p.addMethod($this_1,"scroll",scroll$1,false);function mouseClicked$0(){if($this_1.playGameButton.mouseOverButton()==true&&$this_1.playGameButton.isLocked==false){if($this_1.customMapPicked!=-1){var temp=$this_1.customMaps.get($this_1.customMapPicked);startGame(sketchPath("")+"custom-maps/"+temp[1],$this_1.hardness)}else{startGame("maps/"+$this_1.theMaps[0][$this_1.mapPicked][1],$this_1.hardness)}}else if($this_1.easyButton.mouseOverButton()==true){$this_1.normalButton.isActive=false;$this_1.hardButton.isActive=false;$this_1.easyButton.isActive=true;$this_1.hardness=1}else if($this_1.normalButton.mouseOverButton()==true){$this_1.normalButton.isActive=true;$this_1.hardButton.isActive=false;$this_1.easyButton.isActive=false;$this_1.hardness=2}else if($this_1.hardButton.mouseOverButton()==true){$this_1.normalButton.isActive=false;$this_1.hardButton.isActive=true;$this_1.easyButton.isActive=false;$this_1.hardness=3}else if($this_1.backButton.mouseOverButton()==true){theMenu.changeScreen(0)}else{for(var i=0;i<$this_1.mapButtons.length;i++){if($this_1.mapButtons[i].mouseOverButton()==true){if($this_1.mapPicked==-1){$this_1.playGameButton.isLocked=false}for(var j=0;j<$this_1.customMapButtons.size();j++){var temp2=$this_1.customMapButtons.get(j);temp2.isActive=false}for(var j=0;j<$this_1.mapButtons.length;j++){$this_1.mapButtons[j].isActive=false}$this_1.mapButtons[i].isActive=true;$this_1.mapPicked=i;$this_1.customMapPicked=-1;break}}for(var i=0;i<$this_1.customMapButtons.size();i++){var temp=$this_1.customMapButtons.get(i);if(temp.mouseOverButton()==true){for(var j=0;j<$this_1.mapButtons.length;j++){$this_1.mapButtons[j].isActive=false}for(var j=0;j<$this_1.customMapButtons.size();j++){var temp2=$this_1.customMapButtons.get(j);temp2.isActive=false}temp.isActive=true;$this_1.customMapPicked=i;break}}}}$p.addMethod($this_1,"mouseClicked",mouseClicked$0,false);function $constr_0(){$superCstr();$this_1.backButton=new BUTTON(0,"BACK",65,$p.height-65,110,26);$this_1.playGameButton=new BUTTON(0,"PLAY",$p.width-65-110,$p.height-65,110,26);$this_1.easyButton=new BUTTON(1,"EASY",$p.parseInt($this_1.buttonDistance),40,110,26);$this_1.normalButton=new BUTTON(1,"NORMAL",$p.parseInt($this_1.buttonDistance*2)+110,40,110,26);$this_1.hardButton=new BUTTON(1,"HARD",$p.parseInt($this_1.buttonDistance*3)+220,40,110,26);$this_1.normalButton.isActive=true;$this_1.playGameButton.isLocked=true;$this_1.menuFont=$p.createFont("bitterregular.ttf",48);$this_1.customMaps=new $p.ArrayList;$this_1.customMapIcons=new $p.ArrayList;$this_1.customMapButtons=new $p.ArrayList;$this_1.xmlData=$p.loadXML("maps.xml");var xmlMaps=$this_1.xmlData.getChildren("standardmaps/map");$this_1.theMaps=$p.createJavaArray("String",[2,xmlMaps.length,4]);$this_1.mapButtons=$p.createJavaArray("BUTTON",[xmlMaps.length]);$this_1.theMapIcons=$p.createJavaArray("$p.PImage",[xmlMaps.length]);for(var i=0;i<xmlMaps.length;i++){$this_1.theMaps[0][i][0]=xmlMaps[i].getString("name");$this_1.theMaps[0][i][1]=xmlMaps[i].getString("url");$this_1.theMaps[0][i][2]=xmlMaps[i].getString("img");if($this_1.theMaps[0][i][2]!=""){$this_1.theMapIcons[i]=$p.loadImage("maps/"+$this_1.theMaps[0][i][1]+"/"+$this_1.theMaps[0][i][2])}$this_1.theMaps[0][i][3]=xmlMaps[i].getString("size");$this_1.mapButtons[i]=new BUTTON(3,$this_1.theMaps[0][i][0],$p.width/2-$this_1.mapsWidth/2,$this_1.posTopMaps+i*60+30,300,26)}var p=0;if(globalPlatform==0&&developerMode==true){var customMapPath=new File(sketchPath("")+"custom-maps/");if(customMapPath.exists()){var files=listFiles(sketchPath("")+"custom-maps");for(var i=0;i<files.length;i++){var f=files[i];var maptree=new File(sketchPath("")+"custom-maps/"+f.getName()+"/maptree.xml");if(f.isDirectory()&&maptree.exists()){$this_1.xmlData=$p.loadXML(sketchPath("")+"custom-maps/"+f.getName()+"/maptree.xml");var xmlMap=$this_1.xmlData.getChild("mapsize");var temp=$p.createJavaArray("String",[4]);temp[0]=f.getName();temp[1]=f.getName();temp[2]="map_logo.png";temp[3]=xmlMap.getInt("w")+" x "+xmlMap.getInt("h");$this_1.customMaps.add(temp);$this_1.customMapButtons.add(new BUTTON(3,temp[0],$p.width/2-$this_1.mapsWidth/2,$this_1.posTopMaps+$this_1.mapButtons.length*60+80+p*60+30,300,26));$this_1.customMapIcons.add("test");p++}}}}$this_1.mapButtons[0].isActive=true;$this_1.mapPicked=0;$this_1.playGameButton.isLocked=false}function $constr(){if(arguments.length===0){$constr_0.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return PLAYMENU}();$p.PLAYMENU=PLAYMENU;var THEMAP=function(){function THEMAP(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.xmlData=null;$this_1.mapSize=null;$this_1.difficulty=0;$this_1.tileSize=0;$this_1.mapImage=null;$this_1.tileMap=null;$this_1.EMPTY=-1;$this_1.centerY=0;$this_1.centerX=0;$this_1.zoom=1;$this_1.mapWidth=0;$this_1.mapHeight=0;$this_1.mapPath=null;$this_1.defeated=false;$this_1.pause=false;$this_1.lightRay=null;$this_1.gameStarted=false;$this_1.showBuildAreas=false;$this_1.backToMenu=false;$this_1.backToMenuApply=false;$this_1.enemyWaves=null;$this_1.theWayPoints=null;$this_1.theGui=null;$this_1.theTowers=null;$this_1.theAnimations=null;$this_1.displayObject=null;$this_1.theActions=null;$this_1.theCharSets=null;function canBuild$2(x,y){var temp=pixelToTiles(x,y,$this_1.tileSize);if($this_1.tileMap[temp[0]][temp[1]][0]==1||$this_1.tileMap[temp[0]][temp[1]][0]==3||$this_1.tileMap[temp[0]][temp[1]][0]==4||$this_1.tileMap[temp[0]][temp[1]][0]==5||mouseXp<=85&&mouseXp>=62&&mouseYp>=$p.height-47&&mouseYp<=$p.height-17){return false}else{return true}}$p.addMethod($this_1,"canBuild",canBuild$2,false);function display$0(){if(antiAliasing==true){$p.smooth()}else{$p.noSmooth()}$p.background(100);$p.pushMatrix();$p.translate($this_1.centerX,$this_1.centerY);$p.translate($p.width/2,$p.height/2);$p.scale($this_1.zoom);$p.translate(-$p.width/2,-$p.height/2);if(antiAliasing==true&&globalPlatform==1){$p.tint(255)}$p.image($this_1.mapImage,0,0);$p.noTint();if($this_1.showBuildAreas==true){for(var i=0;i<$this_1.tileMap.length;i++){for(var j=0;j<$this_1.tileMap[i].length;j++){if($this_1.tileMap[i][j][0]!=1&&$this_1.tileMap[i][j][0]!=3&&$this_1.tileMap[i][j][0]!=4&&$this_1.tileMap[i][j][0]!=5){$p.noStroke();$p.fill(51,153,51,120);$p.rect(i*$this_1.tileSize,j*$this_1.tileSize,$this_1.tileSize,$this_1.tileSize,$p.__int_cast($this_1.tileSize/4));$p.noFill()}}}}$this_1.displayObject.display();$this_1.enemyWaves.displayGui();$this_1.theTowers.displayGui();$this_1.theTowers.displayArrow();if($this_1.lightRay!=null){$p.image($this_1.lightRay,0,0)}$p.popMatrix();$this_1.theActions.displayActions();$this_1.theGui.display();if($this_1.backToMenuApply==true){showAfterMatch(false)}}$p.addMethod($this_1,"display",display$0,false);function getTileSize$0(){return $this_1.tileSize}$p.addMethod($this_1,"getTileSize",getTileSize$0,false);

function $constr_4(mapFile,guiScale,menuScale,idifficulty){$superCstr();$this_1.mapPath=mapFile;$this_1.difficulty=idifficulty;$this_1.theCharSets=new CHARSETS($this_1.$self);$this_1.theWayPoints=new WAYPOINTS(mapFile);$this_1.theTowers=new TOWERS(mapFile,$this_1.$self);$this_1.mapImage=$p.loadImage(mapFile+"/data/map.png");$this_1.xmlData=$p.loadXML(mapFile+"/maptree.xml");var xmlTilesize=$this_1.xmlData.getChild("tilesize");$this_1.tileSize=xmlTilesize.getInt("s");var xmlMapsize=$this_1.xmlData.getChild("mapsize");$this_1.mapSize=$p.createJavaArray("int",[2]);$this_1.mapSize[0]=xmlMapsize.getInt("w");$this_1.mapSize[1]=xmlMapsize.getInt("h");$this_1.tileMap=$p.createJavaArray("int",[$this_1.mapSize[0],$this_1.mapSize[1],2]);var xmlLevels=$this_1.xmlData.getChildren("levels/level");$this_1.tileMap=unserializeMap(xmlLevels[2].getContent(),$this_1.mapSize[0],$this_1.mapSize[1]);$this_1.enemyWaves=new WAVES(mapFile,$this_1.theWayPoints,$this_1.theGui,$this_1.$self);$this_1.mapWidth=$this_1.mapSize[0]*$this_1.tileSize;$this_1.mapHeight=$this_1.mapSize[1]*$this_1.tileSize;var xmlGame=$this_1.xmlData.getChild("game");$this_1.theGui=new GUI($p.parseInt(xmlGame.getInt("startmoney")),xmlGame.getInt("lifes"),guiScale,menuScale,$this_1.$self);$this_1.theAnimations=new ANIMATIONS;$this_1.displayObject=new DISPLAY($this_1.$self);$this_1.theActions=new ACTIONS($this_1.$self);$this_1.theActions.startMessage();globalSpeed=1;if(highGraphicsQuality==true){$this_1.lightRay=$p.loadImage("ray1.png")}loadingMap=false;loadedMap=false}function $constr_0(){$superCstr()}function $constr(){if(arguments.length===4){$constr_4.apply($this_1,arguments)}else if(arguments.length===0){$constr_0.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return THEMAP}();$p.THEMAP=THEMAP;var TOWER=function(){function TOWER(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.charSet=null;$this_1.position=[-1,-1];$this_1.towerTileSize=32;$this_1.defenseMap=null;$this_1.drawingOffset=5;$this_1.drawingCount=0;$this_1.drawTowerRadius=false;$this_1.towerDirection=3;$this_1.explosionAtEnemy=true;$this_1.charSetFile=null;$this_1.name=null;$this_1.enemyInReach=false;$this_1.damage=15;$this_1.fireRate=500;$this_1.fireRadius=0;$this_1.fireCount=0;$this_1.health=0;$this_1.maxHealth=0;$this_1.splash=false;$this_1.splashRadius=0;$this_1.splashFactor=0;$this_1.costs=0;$this_1.description=null;$this_1.freeze=0;$this_1.updates=0;$this_1.udamage=null;$this_1.ucosts=null;$this_1.ufirerate=null;$this_1.ufireradius=null;$this_1.currentUpdate=0;$this_1.animationCount=0;$this_1.animationState=0;$this_1.animationStateDirection=1;$this_1.animationSpeed=5;$this_1.shootAngle=0;$this_1.shooting=false;$this_1.arrow=null;$this_1.shootingCount=0;$this_1.shootDirection=0;$this_1.arrowPosition=$p.createJavaArray("float",[2]);$this_1.enemyPosition=$p.createJavaArray("float",[2]);$this_1.shootAtEnemy=null;$this_1.shootingAniState=0;$this_1.enemyLastHit=0;$this_1.hitAniCount=0;$this_1.hitAniPos=$p.createJavaArray("float",[2]);$this_1.hitAni=null;$this_1.hitAniImg=null;$this_1.hitAniBool=false;$this_1.towerDestroyed=false;$this_1.towerDestroyCount=0;$this_1.towerDestroyOpacity=255;$this_1.hasShootingAnimation=false;$this_1.damageIncrease=0;function display$0(){if($this_1.towerDestroyed==false){if($this_1.drawingCount>=$this_1.drawingOffset){var shootAngleTemp=$this_1.shootAngle+$this_1.shootDirection*$p.PI;if($p.millis()-$this_1.enemyLastHit>3e3){$this_1.towerDirection=2}else if(shootAngleTemp>$p.PI/8&&shootAngleTemp<=$p.PI*3/8){$this_1.towerDirection=1}else if(shootAngleTemp>$p.PI*3/8&&shootAngleTemp<=$p.PI*5/8){$this_1.towerDirection=0}else if(shootAngleTemp>$p.PI*5/8&&shootAngleTemp<=$p.PI*7/8){$this_1.towerDirection=5}else if(shootAngleTemp>$p.PI*7/8&&shootAngleTemp<=$p.PI+$p.PI/8){$this_1.towerDirection=6}else if(shootAngleTemp>$p.PI+$p.PI/8&&shootAngleTemp<=$p.PI+$p.PI*3/8||shootAngleTemp<-($p.PI*5/8)&&shootAngleTemp>=-($p.PI*7/8)){$this_1.towerDirection=7}else if(shootAngleTemp>$p.PI+$p.PI*3/8&&shootAngleTemp<=$p.PI+$p.PI*5/8||shootAngleTemp<-($p.PI*3/8)&&shootAngleTemp>=-($p.PI*5/8)){$this_1.towerDirection=4}else if(shootAngleTemp>$p.PI+$p.PI*5/8&&shootAngleTemp<=$p.PI+$p.PI*7/8||shootAngleTemp<-($p.PI/8)&&shootAngleTemp>=-($p.PI*3/8)){$this_1.towerDirection=3}else{$this_1.towerDirection=2}$this_1.defenseMap.theAnimations.animate($this_1.$self);if($this_1.shooting==true&&$this_1.shootingAniState<3&&$this_1.hasShootingAnimation==true){$p.imageMode($p.CENTER);$p.image($this_1.defenseMap.theCharSets.getCharSetPart($this_1.charSetFile,$this_1.currentUpdate*9+$this_1.shootingAniState+3,$this_1.towerDirection),($this_1.position[0]+.5)*$this_1.defenseMap.getTileSize(),($this_1.position[1]+.5)*$this_1.defenseMap.getTileSize()-($this_1.towerTileSize-$this_1.defenseMap.getTileSize())/2);$p.imageMode($p.CORNER);if($p.millis()-$this_1.shootingCount>$this_1.fireRate*.08*($this_1.shootingAniState+1)){if($this_1.shootingAniState<3){$this_1.shootingAniState++}}}else{if($p.millis()-$this_1.animationCount>=1e3/($this_1.animationSpeed*globalSpeed)){$this_1.animationState+=$this_1.animationStateDirection;if($this_1.animationState==3||$this_1.animationState==-1){$this_1.animationState=1;$this_1.animationStateDirection*=-1}$this_1.animationCount=$p.millis()}$p.imageMode($p.CENTER);$p.image($this_1.defenseMap.theCharSets.getCharSetPart($this_1.charSetFile,$this_1.currentUpdate*9+$this_1.animationState,$this_1.towerDirection),($this_1.position[0]+.5)*$this_1.defenseMap.getTileSize(),($this_1.position[1]+.5)*$this_1.defenseMap.getTileSize()-($this_1.towerTileSize-$this_1.defenseMap.getTileSize())/2);$p.imageMode($p.CORNER)}$this_1.defenseMap.theAnimations.animateEnd($this_1.$self);if($p.millis()-$this_1.fireCount>=$this_1.fireRate/globalSpeed){$this_1.$self.checkEnemy();$this_1.fireCount=$p.millis()}}else{$this_1.drawingCount++}}else{$p.imageMode($p.CENTER);var destroyState=8;if($p.millis()-$this_1.towerDestroyCount<100){destroyState=6}else if($p.millis()-$this_1.towerDestroyCount<200){destroyState=7}else if($p.millis()-$this_1.towerDestroyCount<300){}else if($p.millis()-$this_1.towerDestroyCount<400){}else if($p.millis()-$this_1.towerDestroyCount<7e3){$p.tint(255,$this_1.towerDestroyOpacity);if($this_1.towerDestroyOpacity>4){$this_1.towerDestroyOpacity-=10}else{$this_1.towerDestroyOpacity=0}}else{$p.tint(255,0);$this_1.defenseMap.theTowers.removeTower($this_1.$self)}$p.image($this_1.defenseMap.theCharSets.getCharSetPart($this_1.charSetFile,$this_1.currentUpdate*9+destroyState,0),($this_1.position[0]+.5)*$this_1.defenseMap.getTileSize(),($this_1.position[1]+.5)*$this_1.defenseMap.getTileSize()-($this_1.towerTileSize-$this_1.defenseMap.getTileSize())/2);$p.noTint();$p.imageMode($p.CORNER)}}$p.addMethod($this_1,"display",display$0,false);function displayGui$0(){if($this_1.health<$this_1.maxHealth&&$this_1.towerDestroyed==false){$p.stroke(50);$p.fill(204,0,51);$p.rect($this_1.position[0]*$this_1.defenseMap.getTileSize()+$this_1.towerTileSize*.1,$this_1.position[1]*$this_1.defenseMap.getTileSize()-$this_1.towerTileSize*.25,$this_1.defenseMap.getTileSize()*.7,3);$p.fill(0,204,51);$p.rect($this_1.position[0]*$this_1.defenseMap.getTileSize()+$this_1.towerTileSize*.1,$this_1.position[1]*$this_1.defenseMap.getTileSize()-$this_1.towerTileSize*.25,$this_1.defenseMap.getTileSize()*.7*($this_1.health/$this_1.maxHealth),3)}if($this_1.drawTowerRadius==true&&$this_1.towerDestroyed==false){$p.fill(204,255,153,100);$p.stroke(204,255,153,200);$p.ellipseMode($p.CENTER);$p.ellipse(($this_1.position[0]+.5)*$this_1.defenseMap.getTileSize(),($this_1.position[1]+.5)*$this_1.defenseMap.getTileSize(),$this_1.fireRadius,$this_1.fireRadius)}}$p.addMethod($this_1,"displayGui",displayGui$0,false);function displayArrow$0(){if($this_1.shooting==true){if($p.millis()-$this_1.shootingCount<$this_1.fireRate*.5){var c=$p.dist(($this_1.position[0]+.5)*$this_1.defenseMap.getTileSize(),($this_1.position[1]+.5)*$this_1.defenseMap.getTileSize()-($this_1.towerTileSize-$this_1.defenseMap.tileSize)/2,$this_1.enemyPosition[0],$this_1.enemyPosition[1]);var proz=($p.millis()-$this_1.shootingCount)/($this_1.fireRate*.7);$this_1.arrowPosition[0]=$p.cos($this_1.shootAngle+$this_1.shootDirection*$p.PI)*(c-proz*c);$this_1.arrowPosition[1]=$p.sin($this_1.shootAngle+$this_1.shootDirection*$p.PI)*(c-proz*c);$p.pushMatrix();$p.imageMode($p.CENTER);$p.translate($this_1.enemyPosition[0],$this_1.enemyPosition[1]);$p.translate($this_1.arrowPosition[0],$this_1.arrowPosition[1]);$p.rotate($this_1.shootAngle+$this_1.shootDirection*$p.PI);if((proz<.1||proz>.95)&&globalPlatform!=2){$p.tint(255,80)}$this_1.arrow=$this_1.defenseMap.theCharSets.getCharSetPart($this_1.charSetFile,$this_1.currentUpdate*9+6+$this_1.animationState,2);if(proz>.05){$p.image($this_1.arrow,0,0)}$p.imageMode($p.CORNER);$p.noTint();$p.popMatrix()}else{if($this_1.damageIncrease>0){$this_1.shootAtEnemy.hitByTower($this_1.damage,$this_1.freeze,$this_1.$self,$this_1.damageIncrease);if($this_1.splash==true){$this_1.defenseMap.enemyWaves.splashDamage($this_1.shootAtEnemy,$this_1.damage,$this_1.splashRadius,$this_1.splashFactor)}}else{$this_1.shootAtEnemy.hitByTower($this_1.damage,$this_1.freeze);if($this_1.splash==true){$this_1.defenseMap.enemyWaves.splashDamage($this_1.shootAtEnemy,$this_1.damage,$this_1.splashRadius,$this_1.splashFactor)}}if($this_1.explosionAtEnemy==true){$this_1.shootAtEnemy.hitAnimation($this_1.charSetFile,6+$p.parseInt($this_1.currentUpdate*9))}else{$this_1.hitAniCount=$p.millis();$this_1.hitAniPos[0]=$p.parseInt($this_1.enemyPosition[0]);$this_1.hitAniPos[1]=$p.parseInt($this_1.enemyPosition[1]);$this_1.hitAniBool=true}$this_1.shooting=false;$this_1.shootingAniState=0}}}$p.addMethod($this_1,"displayArrow",displayArrow$0,false);function hitAnimation$0(){if($this_1.hitAniBool==true){if($p.millis()-$this_1.hitAniCount<80){$this_1.hitAniImg=$this_1.defenseMap.theCharSets.getCharSetPart($this_1.charSetFile,$p.parseInt(6)+$p.parseInt($this_1.currentUpdate*9),1)}else if($p.millis()-$this_1.hitAniCount<160){$this_1.hitAniImg=$this_1.defenseMap.theCharSets.getCharSetPart($this_1.charSetFile,$p.parseInt(7)+$p.parseInt($this_1.currentUpdate*9),1)}else if($p.millis()-$this_1.hitAniCount<240){$this_1.hitAniImg=$this_1.defenseMap.theCharSets.getCharSetPart($this_1.charSetFile,$p.parseInt(8)+$p.parseInt($this_1.currentUpdate*9),1)}else{$this_1.hitAniBool=false}$p.imageMode($p.CENTER);$p.image($this_1.hitAniImg,$this_1.hitAniPos[0],$this_1.hitAniPos[1]);$p.imageMode($p.CORNER)}}$p.addMethod($this_1,"hitAnimation",hitAnimation$0,false);function checkEnemy$0(){var id=$this_1.defenseMap.enemyWaves.checkEnemy($p.__int_cast(($this_1.position[0]+.5)*$this_1.defenseMap.getTileSize()),$p.__int_cast(($this_1.position[1]+.5)*$this_1.defenseMap.getTileSize()),$this_1.fireRadius/2+$this_1.towerTileSize/4,$this_1.freeze);if(id!=-1){var temp=$this_1.defenseMap.enemyWaves.getEnemy(id);$this_1.shootAtEnemy=temp;var enemyPos=temp.calcEnemyPosInFuture($p.__int_cast($this_1.fireRate*.5));$this_1.$self.shoot(enemyPos[0],enemyPos[1]-(temp.enemyTileSize/2-$this_1.defenseMap.tileSize/2))}}$p.addMethod($this_1,"checkEnemy",checkEnemy$0,false);function calculateShootAngle$2(x,y){$this_1.shootAngle=$p.atan((($this_1.position[1]+.5)*$this_1.defenseMap.getTileSize()-($this_1.towerTileSize-$this_1.defenseMap.tileSize)/2-y)/(($this_1.position[0]+.5)*$this_1.defenseMap.getTileSize()-x))}$p.addMethod($this_1,"calculateShootAngle",calculateShootAngle$2,false);function shoot$2(x,y){if(x>($this_1.position[0]+.5)*$this_1.defenseMap.getTileSize()){$this_1.shootDirection=1}else{$this_1.shootDirection=0}$this_1.$self.calculateShootAngle(x,y);$this_1.arrowPosition[0]=($this_1.position[0]+.5)*$this_1.defenseMap.getTileSize();$this_1.arrowPosition[1]=($this_1.position[1]+.5)*$this_1.defenseMap.getTileSize()-($this_1.towerTileSize-$this_1.defenseMap.tileSize)/2;$this_1.enemyPosition[0]=x;$this_1.enemyPosition[1]=y;$this_1.shootingCount=$p.millis();$this_1.shooting=true;$this_1.enemyLastHit=$p.millis()}$p.addMethod($this_1,"shoot",shoot$2,false);function enemyDamage$1(damage){$this_1.health-=damage;if($this_1.health<0&&$this_1.towerDestroyed==false){$this_1.towerDestroyed=true;$this_1.towerDestroyCount=$p.millis()}}$p.addMethod($this_1,"enemyDamage",enemyDamage$1,false);function getDescription$0(){return"DMG: "+$this_1.damage+"   FR: "+$this_1.fireRate/1e3+"s\n"+$this_1.description}$p.addMethod($this_1,"getDescription",getDescription$0,false);function getRepairCosts$0(){return $p.__int_cast((1-$this_1.health/$this_1.maxHealth)*(10+$this_1.currentUpdate*10))+1}$p.addMethod($this_1,"getRepairCosts",getRepairCosts$0,false);function repairTower$0(){if($this_1.defenseMap.theGui.money>=$this_1.$self.getRepairCosts()&&$this_1.health<$this_1.maxHealth){$this_1.defenseMap.theGui.money-=$this_1.$self.getRepairCosts();$this_1.health=$this_1.maxHealth}}$p.addMethod($this_1,"repairTower",repairTower$0,false);function updateTower$0(){if($this_1.updates>0&&$this_1.updates!=$this_1.currentUpdate&&$this_1.defenseMap.theGui.money>=$this_1.ucosts[$this_1.currentUpdate]){$this_1.damage=$this_1.udamage[$this_1.currentUpdate];$this_1.fireRate=$this_1.ufirerate[$this_1.currentUpdate];$this_1.fireRadius=$this_1.ufireradius[$this_1.currentUpdate];$this_1.costs=$p.__int_cast($this_1.costs)+$p.__int_cast($this_1.ucosts[$this_1.currentUpdate]);$this_1.defenseMap.theGui.money-=$this_1.ucosts[$this_1.currentUpdate];$this_1.currentUpdate++}}$p.addMethod($this_1,"updateTower",updateTower$0,false);function $constr_20(icharSetFile,iexplosionAtEnemy,ihasShootingAnimation,itileSize,x,y,iname,idamage,ifireRate,ifireRadius,imaxHealth,isplash,isplashRadius,isplashFactor,ifreeze,icosts,idescription,idefenseMap,idamageIncrease,iupdates){$superCstr();$this_1.towerTileSize=itileSize;$this_1.position[0]=x;$this_1.position[1]=y;$this_1.defenseMap=idefenseMap;$this_1.charSetFile=icharSetFile;$this_1.defenseMap.theCharSets.addCharSet($this_1.charSetFile,itileSize);$this_1.charSet=$this_1.defenseMap.theCharSets.getCharSet($this_1.charSetFile);$this_1.maxHealth=imaxHealth;$this_1.health=imaxHealth;$this_1.name=iname;$this_1.splash=isplash;$this_1.fireRate=ifireRate;$this_1.fireRadius=ifireRadius;$this_1.damage=idamage;$this_1.costs=icosts;$this_1.splashRadius=isplashRadius;$this_1.splashFactor=isplashFactor;$this_1.description=idescription;$this_1.freeze=ifreeze;$this_1.updates=iupdates;$this_1.explosionAtEnemy=iexplosionAtEnemy;$this_1.hasShootingAnimation=ihasShootingAnimation;$this_1.damageIncrease=idamageIncrease}function $constr_24(icharSetFile,iexplosionAtEnemy,ihasShootingAnimation,itileSize,x,y,iname,idamage,ifireRate,ifireRadius,imaxHealth,isplash,isplashRadius,isplashFactor,ifreeze,icosts,idescription,idefenseMap,idamageIncrease,iupdates,iucosts,iudamage,iufirerate,iufireradius){$superCstr();$this_1.towerTileSize=itileSize;$this_1.position[0]=x;$this_1.position[1]=y;$this_1.defenseMap=idefenseMap;$this_1.charSetFile=icharSetFile;$this_1.defenseMap.theCharSets.addCharSet($this_1.charSetFile,itileSize);$this_1.charSet=$this_1.defenseMap.theCharSets.getCharSet($this_1.charSetFile);$this_1.maxHealth=imaxHealth;$this_1.health=imaxHealth;$this_1.name=iname;$this_1.splash=isplash;$this_1.fireRate=ifireRate;$this_1.fireRadius=ifireRadius;$this_1.damage=idamage;$this_1.costs=icosts;$this_1.splashRadius=isplashRadius;$this_1.splashFactor=isplashFactor;$this_1.description=idescription;$this_1.freeze=ifreeze;$this_1.updates=iupdates;$this_1.ucosts=iucosts;$this_1.udamage=iudamage;$this_1.ufirerate=iufirerate;$this_1.ufireradius=iufireradius;$this_1.explosionAtEnemy=iexplosionAtEnemy;$this_1.hasShootingAnimation=ihasShootingAnimation;$this_1.damageIncrease=idamageIncrease}function $constr(){if(arguments.length===20){$constr_20.apply($this_1,arguments)}else if(arguments.length===24){$constr_24.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return TOWER}();$p.TOWER=TOWER;var TOWERINFO=function(){function TOWERINFO(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.desc=null;$this_1.defenseMap=null;$this_1.x=$p.width-200;$this_1.y=$p.height-90;$this_1.w=180;$this_1.h=30;$this_1.rx=10;$this_1.ry=10;$this_1.font=null;function updateDesc$1(idesc){$this_1.desc=idesc}$p.addMethod($this_1,"updateDesc",updateDesc$1,false);function display$0(){$p.translate(-$this_1.defenseMap.centerX,-$this_1.defenseMap.centerY);$p.pushMatrix();$p.translate(-(($p.width-$this_1.w-20)*($this_1.defenseMap.theGui.guiScale-1))-(($this_1.w+20)*$this_1.defenseMap.theGui.guiScale-($this_1.w+20)),-(($p.height-($this_1.h+60))*($this_1.defenseMap.theGui.guiScale-1))-(($this_1.h+60)*$this_1.defenseMap.theGui.guiScale-($this_1.h+60)));$p.scale($this_1.defenseMap.theGui.guiScale);$p.noStroke();$p.fill(0,160);$this_1.defenseMap.theAnimations.animate($this_1.$self);$p.beginShape();$p.vertex($this_1.x,$this_1.y+$this_1.ry);$p.bezierVertex($this_1.x,$this_1.y,$this_1.x,$this_1.y,$this_1.x+$this_1.rx,$this_1.y);$p.vertex($this_1.x+$this_1.w-$this_1.rx,$this_1.y);$p.bezierVertex($this_1.x+$this_1.w,$this_1.y,$this_1.x+$this_1.w,$this_1.y,$this_1.x+$this_1.w,$this_1.y+$this_1.ry);$p.vertex($this_1.x+$this_1.w,$this_1.y+$this_1.h-$this_1.ry);$p.bezierVertex($this_1.x+$this_1.w,$this_1.y+$this_1.h,$this_1.x+$this_1.w,$this_1.y+$this_1.h,$this_1.x+$this_1.w-$this_1.rx,$this_1.y+$this_1.h);$p.vertex($this_1.x+$this_1.rx,$this_1.y+$this_1.h);$p.bezierVertex($this_1.x,$this_1.y+$this_1.h,$this_1.x,$this_1.y+$this_1.h,$this_1.x,$this_1.y+$this_1.h-$this_1.ry);$p.endShape($p.CLOSE);$p.fill(255);$p.textFont($this_1.font);$p.textLeading(14);$p.text($this_1.desc,$this_1.x+5,$this_1.y+12);$p.popMatrix();$this_1.defenseMap.theAnimations.animateEnd($this_1.$self)}$p.addMethod($this_1,"display",display$0,false);function $constr_2(idesc,idefenseMap){$superCstr();$this_1.desc=idesc;$this_1.defenseMap=idefenseMap;$this_1.font=$p.createFont("Arial",10)}function $constr(){if(arguments.length===2){$constr_2.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return TOWERINFO}();$p.TOWERINFO=TOWERINFO;var TOWERMENU=function(){function TOWERMENU(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.font=null;$this_1.defenseMap=null;$this_1.towerIcons=null;$this_1.bmRadius=0;$this_1.bmAngle=0;$this_1.bmPosition=null;$this_1.iconSize=30;$this_1.iconCount=3;$this_1.distanceFromBorderX=0;$this_1.distanceFromBorderY=0;$this_1.tmActive=null;$this_1.tmInfo=null;function display$0(){$this_1.defenseMap.theAnimations.animate($this_1.$self);$p.pushMatrix();var x=inputHandler.mapToWinX(($this_1.bmPosition[0]+.5)*$this_1.defenseMap.tileSize+$this_1.distanceFromBorderX);var y=inputHandler.mapToWinY(($this_1.bmPosition[1]+.5)*$this_1.defenseMap.tileSize+$this_1.distanceFromBorderY);$p.translate(-x*($this_1.defenseMap.theGui.menuScale-1),-y*($this_1.defenseMap.theGui.menuScale-1));$p.scale($this_1.defenseMap.theGui.menuScale);for(var i=0;i<$this_1.iconCount;i++){$p.imageMode($p.CENTER);if(antiAliasing==true&&globalPlatform==1){$p.tint(255)}if(i==1&&($this_1.tmActive.updates==0||$this_1.tmActive.currentUpdate==$this_1.tmActive.updates||$this_1.defenseMap.theGui.money<$this_1.tmActive.ucosts[$this_1.tmActive.currentUpdate])){$p.tint(150,200)}if(i==0&&($this_1.tmActive.health==$this_1.tmActive.maxHealth||$this_1.defenseMap.theGui.money<$this_1.tmActive.getRepairCosts())){$p.tint(150,200)}$p.image($this_1.towerIcons[i],x+$p.sin($this_1.bmAngle*i)*$this_1.bmRadius,y+$p.cos($this_1.bmAngle*i)*$this_1.bmRadius,$this_1.iconSize,$this_1.iconSize);$p.imageMode($p.CORNER);$p.noTint();$p.textAlign($p.CENTER);$p.textFont($this_1.font,10);$p.fill(0,190);$p.noStroke();$p.rectMode($p.CENTER);$p.rect(x+$p.sin($this_1.bmAngle*i)*$this_1.bmRadius,y+$p.cos($this_1.bmAngle*i)*$this_1.bmRadius+$this_1.iconSize/5,$this_1.iconSize*.8,$this_1.iconSize/3);$p.fill(255);var tempcosts=0;switch(i){case 0:if($this_1.tmActive.health!=$this_1.tmActive.maxHealth){tempcosts=$this_1.tmActive.getRepairCosts()}break;case 1:if($this_1.tmActive.updates>0&&$this_1.tmActive.currentUpdate!=$this_1.tmActive.updates){tempcosts=$this_1.tmActive.ucosts[$this_1.tmActive.currentUpdate]}break;case 2:tempcosts=$p.__int_cast($this_1.tmActive.costs*.8)}$p.text(tempcosts+" $",x+$p.sin($this_1.bmAngle*i)*$this_1.bmRadius,y+$p.cos($this_1.bmAngle*i)*$this_1.bmRadius+$this_1.iconSize/3-1);$p.textAlign($p.LEFT);$p.imageMode($p.CORNER);$p.rectMode($p.CORNER)}$p.popMatrix();$this_1.defenseMap.theAnimations.animateEnd($this_1.$self);$this_1.tmInfo.display()}$p.addMethod($this_1,"display",display$0,false);function closeMenu$0(){$this_1.defenseMap.theAnimations.removeAnimation($this_1.tmActive);$this_1.tmActive.drawTowerRadius=false}$p.addMethod($this_1,"closeMenu",closeMenu$0,false);function mouseOver$2(x,y){var returnVar=-1;for(var i=0;i<$this_1.iconCount;i++){var distance=$p.dist(x,y,(($this_1.bmPosition[0]+.5)*$this_1.defenseMap.tileSize+$this_1.distanceFromBorderX)*$this_1.defenseMap.zoom+$p.sin($this_1.bmAngle*i)*($this_1.bmRadius*$this_1.defenseMap.theGui.menuScale),($this_1.bmPosition[1]+.5)*$this_1.defenseMap.tileSize*$this_1.defenseMap.zoom+$this_1.distanceFromBorderY+$p.cos($this_1.bmAngle*i)*($this_1.bmRadius*$this_1.defenseMap.theGui.menuScale));if(distance<=$p.parseInt($p.parseInt($this_1.iconSize/2)+4)){returnVar=i;break}}return returnVar}$p.addMethod($this_1,"mouseOver",mouseOver$2,false);function $constr_2(idefenseMap,id){$superCstr();$this_1.defenseMap=idefenseMap;$this_1.bmPosition=pixelToTiles(inputHandler.winToMapX(mouseXp),inputHandler.winToMapY(mouseYp),$this_1.defenseMap.tileSize);$this_1.tmActive=$this_1.defenseMap.theTowers.getTower(id);$this_1.tmActive.drawTowerRadius=true;$this_1.towerIcons=$p.createJavaArray("$p.PImage",[$this_1.iconCount]);$this_1.towerIcons[0]=$p.loadImage("repair_icon.png");$this_1.towerIcons[1]=$p.loadImage("update_icon.png");$this_1.towerIcons[2]=$p.loadImage("sell_icon.png");$this_1.bmRadius=$p.__int_cast($this_1.iconSize*1.5*$this_1.iconCount/(2*$p.PI));$this_1.bmAngle=2*$p.PI/$this_1.iconCount;if($this_1.bmRadius<$this_1.iconSize*1.1){$this_1.bmRadius=$p.__int_cast($this_1.iconSize*1.1)}$this_1.tmInfo=new TOWERINFO($this_1.tmActive.getDescription(),$this_1.defenseMap);$this_1.defenseMap.theAnimations.addAnimation($this_1.tmInfo,[[1,210,0,180,0,0]]);$this_1.font=$p.createFont("Arial",48);if($this_1.bmPosition[0]==0){$this_1.distanceFromBorderX=$this_1.bmRadius+$p.__int_cast($this_1.iconSize/2)-$p.__int_cast($this_1.defenseMap.tileSize/2)}if($this_1.bmPosition[0]==$this_1.defenseMap.mapSize[0]-1){$this_1.distanceFromBorderX=-($this_1.bmRadius+$p.__int_cast($this_1.iconSize/2)-$p.__int_cast($this_1.defenseMap.tileSize/2))}if($this_1.bmPosition[1]==0){$this_1.distanceFromBorderY=$this_1.bmRadius+$p.__int_cast($this_1.iconSize/2)-$p.__int_cast($this_1.defenseMap.tileSize/2)}if($this_1.bmPosition[1]==$this_1.defenseMap.mapSize[1]-1){$this_1.distanceFromBorderY=-($this_1.bmRadius+$p.__int_cast($this_1.iconSize/2)-$p.__int_cast($this_1.defenseMap.tileSize/2))}}function $constr(){if(arguments.length===2){$constr_2.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return TOWERMENU}();$p.TOWERMENU=TOWERMENU;var TOWERS=function(){function TOWERS(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.xmlData=null;$this_1.towers=null;$this_1.towerTypes=null;$this_1.defenseMap=null;function isTower$2(x,y){var returnVar=-1;var temp_pos=pixelToTiles(x,y,$this_1.defenseMap.tileSize);for(var i=0;i<$this_1.towers.size();i++){var temp=$this_1.towers.get(i);if(temp.position[0]==temp_pos[0]&&temp.position[1]==temp_pos[1]&&temp.towerDestroyed==false){returnVar=i;break}}return returnVar}$p.addMethod($this_1,"isTower",isTower$2,false);function getTower$1(id){return $this_1.towers.get(id)}$p.addMethod($this_1,"getTower",getTower$1,false);function removeTower$1(itower){for(var i=0;i<$this_1.towers.size();i++){var temp=$this_1.towers.get(i);if($p.__equals(itower,temp)){temp=null;$this_1.towers.remove(i);break}}}$p.addMethod($this_1,"removeTower",removeTower$1,false);function addTower$3(id,x,y){if($this_1.towerTypes[id].costs<=$this_1.defenseMap.theGui.money){if($this_1.defenseMap.gameStarted==false){$this_1.defenseMap.theActions.startGame()}$this_1.defenseMap.theGui.money-=$this_1.towerTypes[id].costs;var temp=$p.createJavaArray("int",[2]);temp[0]=x;temp[1]=y;if($this_1.towerTypes[id].updates>0){$this_1.towers.add(new TOWER($this_1.towerTypes[id].charSet,$this_1.towerTypes[id].explosionAtEnemy,$this_1.towerTypes[id].hasShootingAnimation,$this_1.towerTypes[id].tileSize,temp[0],temp[1],$this_1.towerTypes[id].name,$this_1.towerTypes[id].damage,$this_1.towerTypes[id].fireRate,$this_1.towerTypes[id].fireRadius,$this_1.towerTypes[id].maxHealth,$this_1.towerTypes[id].splashDamage,$this_1.towerTypes[id].splashRadius,$this_1.towerTypes[id].splashFactor,$this_1.towerTypes[id].freeze,$this_1.towerTypes[id].costs,$this_1.towerTypes[id].description,$this_1.defenseMap,$this_1.towerTypes[id].damageIncrease,$this_1.towerTypes[id].updates,$this_1.towerTypes[id].ucosts,$this_1.towerTypes[id].udamage,$this_1.towerTypes[id].ufirerate,$this_1.towerTypes[id].ufireradius))}else{$this_1.towers.add(new TOWER($this_1.towerTypes[id].charSet,$this_1.towerTypes[id].explosionAtEnemy,$this_1.towerTypes[id].hasShootingAnimation,$this_1.towerTypes[id].tileSize,temp[0],temp[1],$this_1.towerTypes[id].name,$this_1.towerTypes[id].damage,$this_1.towerTypes[id].fireRate,$this_1.towerTypes[id].fireRadius,$this_1.towerTypes[id].maxHealth,$this_1.towerTypes[id].splashDamage,$this_1.towerTypes[id].splashRadius,$this_1.towerTypes[id].splashFactor,$this_1.towerTypes[id].freeze,$this_1.towerTypes[id].costs,$this_1.towerTypes[id].description,$this_1.defenseMap,$this_1.towerTypes[id].damageIncrease,$this_1.towerTypes[id].updates))}}}$p.addMethod($this_1,"addTower",addTower$3,false);function displayGui$0(){for(var i=0;i<$this_1.towers.size();i++){var temp=$this_1.towers.get(i);temp.displayGui()}}$p.addMethod($this_1,"displayGui",displayGui$0,false);function displayArrow$0(){for(var i=0;i<$this_1.towers.size();i++){var temp=$this_1.towers.get(i);temp.displayArrow();temp.hitAnimation()}}$p.addMethod($this_1,"displayArrow",displayArrow$0,false);function checkTowers$4(x,y,radius,damage){for(var i=0;i<$this_1.towers.size();i++){var temp=$this_1.towers.get(i);if($p.dist((temp.position[0]+.5)*$this_1.defenseMap.getTileSize(),(temp.position[1]+.5)*$this_1.defenseMap.getTileSize(),x,y)<=radius){temp.enemyDamage(damage)}}}$p.addMethod($this_1,"checkTowers",checkTowers$4,false);function sellTower$1(itower){$this_1.defenseMap.theGui.money+=$p.__int_cast(itower.costs*.8);for(var i=0;i<$this_1.towers.size();i++){var temp=$this_1.towers.get(i);if($p.__equals(temp,itower)==true){temp=null;$this_1.towers.remove(i);break}}}$p.addMethod($this_1,"sellTower",sellTower$1,false);function $constr_2(mapFile,idefenseMap){$superCstr();$this_1.towers=new $p.ArrayList;$this_1.defenseMap=idefenseMap;$this_1.xmlData=$p.loadXML(mapFile+"/towers.xml");var xmlTowers=$this_1.xmlData.getChildren("towers/tower");$this_1.towerTypes=$p.createJavaArray("TOWERTYPE",[xmlTowers.length]);for(var i=0;i<xmlTowers.length;i++){var explosionAtEnemy=false;var hasShootingAnimation=false;if(xmlTowers[i].getInt("explosionatenemy")==1){explosionAtEnemy=true}if(xmlTowers[i].getInt("hasshootinganimation")==1){hasShootingAnimation=true}var updates=$p.parseInt(xmlTowers[i].getInt("updates"));if(updates>0){var ucosts=$p.createJavaArray("int",[updates]);var udamage=$p.createJavaArray("int",[updates]);var ufirerate=$p.createJavaArray("int",[updates]);var ufireradius=$p.createJavaArray("int",[updates]);for(var j=0;j<updates;j++){ucosts[j]=xmlTowers[i].getInt("u"+(j+1)+"-costs");udamage[j]=xmlTowers[i].getInt("u"+(j+1)+"-damage");ufirerate[j]=xmlTowers[i].getInt("u"+(j+1)+"-firerate");ufireradius[j]=xmlTowers[i].getInt("u"+(j+1)+"-fireradius")}$this_1.towerTypes[i]=new TOWERTYPE(xmlTowers[i].getString("name"),xmlTowers[i].getString("charset"),explosionAtEnemy,hasShootingAnimation,xmlTowers[i].getString("towericon"),xmlTowers[i].getInt("towericonsize"),xmlTowers[i].getInt("tilesize"),xmlTowers[i].getInt("damage"),xmlTowers[i].getInt("firerate"),xmlTowers[i].getInt("fireradius"),xmlTowers[i].getInt("splash"),xmlTowers[i].getInt("splashradius"),xmlTowers[i].getFloat("splashfactor"),xmlTowers[i].getFloat("freeze"),xmlTowers[i].getInt("costs"),xmlTowers[i].getInt("maxhealth"),xmlTowers[i].getContent(),xmlTowers[i].getFloat("damageincrease"),xmlTowers[i].getInt("updates"),ucosts,udamage,ufirerate,ufireradius)}else{$this_1.towerTypes[i]=new TOWERTYPE(xmlTowers[i].getString("name"),xmlTowers[i].getString("charset"),explosionAtEnemy,hasShootingAnimation,xmlTowers[i].getString("towericon"),xmlTowers[i].getInt("towericonsize"),xmlTowers[i].getInt("tilesize"),xmlTowers[i].getInt("damage"),xmlTowers[i].getInt("firerate"),xmlTowers[i].getInt("fireradius"),xmlTowers[i].getInt("splash"),xmlTowers[i].getInt("splashradius"),xmlTowers[i].getFloat("splashfactor"),xmlTowers[i].getFloat("freeze"),xmlTowers[i].getInt("costs"),xmlTowers[i].getInt("maxhealth"),xmlTowers[i].getContent(),xmlTowers[i].getFloat("damageincrease"),xmlTowers[i].getInt("updates"))}}}function $constr_0(){$superCstr()}function $constr(){if(arguments.length===2){$constr_2.apply($this_1,arguments)}else if(arguments.length===0){$constr_0.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return TOWERS}();$p.TOWERS=TOWERS;var TOWERTYPE=function(){function TOWERTYPE(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.name=null;$this_1.charSet=null;$this_1.tileSize=0;$this_1.damage=0;$this_1.fireRate=0;$this_1.fireRadius=0;$this_1.splashDamage=false;$this_1.splashRadius=0;$this_1.splashFactor=0;$this_1.costs=0;$this_1.maxHealth=0;$this_1.towerIcon=null;$this_1.towerIconSize=0;$this_1.description=null;$this_1.freeze=0;$this_1.updates=0;$this_1.ucosts=null;$this_1.udamage=null;$this_1.ufirerate=null;$this_1.ufireradius=null;$this_1.explosionAtEnemy=false;$this_1.hasShootingAnimation=false;$this_1.damageIncrease=0;function $constr_23(iname,icharSet,iexplosionAtEnemy,ihasShootingAnimation,itowerIcon,itowerIconSize,itileSize,idamage,ifireRate,ifireRadius,isplashDamage,isplashRadius,isplashFactor,ifreeze,icosts,imaxHealth,idescription,idamageIncrease,iupdates,iucosts,iudamage,iufirerate,iufireradius){$superCstr();$this_1.name=iname;$this_1.charSet=icharSet;$this_1.tileSize=itileSize;$this_1.damage=idamage;$this_1.fireRate=ifireRate;$this_1.fireRadius=ifireRadius;$this_1.costs=icosts;$this_1.maxHealth=imaxHealth;$this_1.towerIcon=itowerIcon;$this_1.towerIconSize=itowerIconSize;if(isplashDamage==0){$this_1.splashDamage=false}else{$this_1.splashDamage=true}$this_1.splashRadius=isplashRadius;$this_1.splashFactor=isplashFactor;$this_1.description=idescription;$this_1.freeze=ifreeze;$this_1.updates=iupdates;$this_1.udamage=iudamage;$this_1.ufirerate=iufirerate;$this_1.ufireradius=iufireradius;$this_1.ucosts=iucosts;$this_1.explosionAtEnemy=iexplosionAtEnemy;$this_1.hasShootingAnimation=ihasShootingAnimation;$this_1.damageIncrease=idamageIncrease}function $constr_19(iname,icharSet,iexplosionAtEnemy,ihasShootingAnimation,itowerIcon,itowerIconSize,itileSize,idamage,ifireRate,ifireRadius,isplashDamage,isplashRadius,isplashFactor,ifreeze,icosts,imaxHealth,idescription,idamageIncrease,iupdates){$superCstr();$this_1.name=iname;$this_1.charSet=icharSet;$this_1.tileSize=itileSize;$this_1.damage=idamage;$this_1.fireRate=ifireRate;$this_1.fireRadius=ifireRadius;$this_1.costs=icosts;$this_1.maxHealth=imaxHealth;$this_1.towerIcon=itowerIcon;$this_1.towerIconSize=itowerIconSize;if(isplashDamage==0){$this_1.splashDamage=false}else{$this_1.splashDamage=true}$this_1.splashRadius=isplashRadius;$this_1.splashFactor=isplashFactor;$this_1.description=idescription;$this_1.freeze=ifreeze;$this_1.updates=iupdates;$this_1.explosionAtEnemy=iexplosionAtEnemy;

$this_1.hasShootingAnimation=ihasShootingAnimation;$this_1.damageIncrease=idamageIncrease}function $constr(){if(arguments.length===23){$constr_23.apply($this_1,arguments)}else if(arguments.length===19){$constr_19.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return TOWERTYPE}();$p.TOWERTYPE=TOWERTYPE;var WAVE=function(){function WAVE(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.enemies=null;$this_1.theWave=null;$this_1.theWayPoints=null;$this_1.enemyDistance=50;$this_1.offsetDistance=500;$this_1.wholeDistance=0;$this_1.waveStarting=false;$this_1.defenseMap=null;function startWave$0(){$this_1.wholeDistance=$p.millis();$this_1.waveStarting=true}$p.addMethod($this_1,"startWave",startWave$0,false);function calcEnemyDistance$0(){if($this_1.waveStarting==true){var again=0;for(var i=0;i<$this_1.theWave.size();i++){if($p.millis()-$this_1.wholeDistance>i*$this_1.enemyDistance+$this_1.offsetDistance){var temp=$this_1.theWave.get(i);if(temp.wayPointsSet==false){temp.setWaypoints($this_1.theWayPoints.getStart(),$this_1.theWayPoints.getEnd(),$this_1.theWayPoints.getWP());again=i+1}}else{break}}if(again==$this_1.theWave.size()){$this_1.waveStarting=false}}}$p.addMethod($this_1,"calcEnemyDistance",calcEnemyDistance$0,false);function displayGui$0(){for(var i=0;i<$this_1.theWave.size();i++){if($p.millis()-$this_1.wholeDistance>i*$this_1.enemyDistance+$this_1.offsetDistance){var temp=$this_1.theWave.get(i);temp.displayGui()}}}$p.addMethod($this_1,"displayGui",displayGui$0,false);function waveSplash$4(ienemy,damage,splashRadius,splashFactor){for(var i=0;i<$this_1.theWave.size();i++){var temp=$this_1.theWave.get(i);if($p.dist(ienemy.position[0],ienemy.position[1],temp.position[0],temp.position[1])<splashRadius&&temp!=ienemy&&temp.enemyAlive==true){temp.hitByTower($p.__int_cast(damage*splashFactor),0)}}}$p.addMethod($this_1,"waveSplash",waveSplash$4,false);function waveCheckEnemy$4(towerX,towerY,towerRadius,freeze){Collections.sort($this_1.theWave,new enemyComparator);var temp=null;var tempPos=null;var output=-1;for(var i=0;i<$this_1.theWave.size();i++){temp=$this_1.theWave.get(i);tempPos=temp.getPosition();if($p.dist(tempPos[0],tempPos[1],towerX,towerY)<=towerRadius&&temp.alive()==true&&temp.position[0]>0){if(freeze==0||temp.frozen==false||temp.freezeCount<$p.millis()-temp.freezeTime+300){output=i;break}}}if(output==-1){for(var i=0;i<$this_1.theWave.size();i++){temp=$this_1.theWave.get(i);tempPos=temp.getPosition();if($p.dist(tempPos[0],tempPos[1],towerX,towerY)<=towerRadius&&temp.alive()==true&&temp.position[0]>0){output=i;break}}}return output}$p.addMethod($this_1,"waveCheckEnemy",waveCheckEnemy$4,false);function waveNextEnemies$2(x,y){for(var i=0;i<$this_1.enemies.length;i++){if($this_1.enemies[i].enemyIcon!=null){$p.image($this_1.enemies[i].enemyIcon,x+i*32,y)}}}$p.addMethod($this_1,"waveNextEnemies",waveNextEnemies$2,false);function waveGetEnemy$1(id){return $this_1.theWave.get(id)}$p.addMethod($this_1,"waveGetEnemy",waveGetEnemy$1,false);function waveIsComplete$0(){var returnVar=true;for(var i=0;i<$this_1.theWave.size();i++){var temp=$this_1.theWave.get(i);if(temp.enemyAlive==true||temp.enemyDied==false){returnVar=false;break}else{temp=null}}return returnVar}$p.addMethod($this_1,"waveIsComplete",waveIsComplete$0,false);function $constr_5(itheWayPoints,ienemyDistance,xmlEnemies,itheGui,idefenseMap){$superCstr();$this_1.defenseMap=idefenseMap;$this_1.enemyDistance=ienemyDistance;$this_1.theWayPoints=itheWayPoints;$this_1.theWave=new $p.ArrayList;$this_1.wholeDistance=$p.millis();$this_1.enemies=$p.createJavaArray("ENEMY",[xmlEnemies.length]);for(var i=0;i<xmlEnemies.length;i++){for(var j=0;j<xmlEnemies[i].getInt("count");j++){var temp=new ENEMY(xmlEnemies[i].getString("charset"),xmlEnemies[i].getString("icon"),xmlEnemies[i].getInt("tilesize"),xmlEnemies[i].getInt("maxhealth"),xmlEnemies[i].getInt("movespeed"),xmlEnemies[i].getInt("money"),xmlEnemies[i].getInt("damage"),xmlEnemies[i].getInt("animationspeed"),itheGui,$this_1.defenseMap);if(j==0){$this_1.enemies[i]=temp}$this_1.theWave.add(temp)}}}function $constr_0(){$superCstr()}function $constr(){if(arguments.length===5){$constr_5.apply($this_1,arguments)}else if(arguments.length===0){$constr_0.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return WAVE}();$p.WAVE=WAVE;var WAVES=function(){function WAVES(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.xmlData=null;$this_1.theWaves=null;$this_1.currentWave=0;$this_1.defenseMap=null;$this_1.started=false;function nextWave$0(){$this_1.started=true;$this_1.theWaves[$this_1.currentWave].startWave()}$p.addMethod($this_1,"nextWave",nextWave$0,false);function displayGui$0(){if($this_1.started==true){$this_1.theWaves[$this_1.currentWave].displayGui()}}$p.addMethod($this_1,"displayGui",displayGui$0,false);function waveComplete$0(){if($this_1.theWaves[$this_1.currentWave].waveIsComplete()==true&&$this_1.defenseMap.defeated==false){if($this_1.currentWave+1>=$this_1.theWaves.length){$this_1.defenseMap.theActions.wonGame()}else{$this_1.theWaves[$this_1.currentWave]=null;$this_1.currentWave++;$this_1.defenseMap.theActions.continueNextWave()}}}$p.addMethod($this_1,"waveComplete",waveComplete$0,false);function nextEnemies$2(x,y){if($this_1.currentWave+1<$this_1.theWaves.length){$this_1.theWaves[$this_1.currentWave+1].waveNextEnemies(x,y)}}$p.addMethod($this_1,"nextEnemies",nextEnemies$2,false);function checkEnemy$4(towerX,towerY,towerRadius,freeze){return $this_1.theWaves[$this_1.currentWave].waveCheckEnemy(towerX,towerY,towerRadius,freeze)}$p.addMethod($this_1,"checkEnemy",checkEnemy$4,false);function getEnemy$1(id){return $this_1.theWaves[$this_1.currentWave].waveGetEnemy(id)}$p.addMethod($this_1,"getEnemy",getEnemy$1,false);function splashDamage$4(ienemy,damage,splashRadius,splashFactor){$this_1.theWaves[$this_1.currentWave].waveSplash(ienemy,damage,splashRadius,splashFactor)}$p.addMethod($this_1,"splashDamage",splashDamage$4,false);function $constr_4(mapFile,itheWaypoints,itheGui,idefenseMap){$superCstr();$this_1.defenseMap=idefenseMap;$this_1.xmlData=$p.loadXML(mapFile+"/waves.xml");var xmlWaves=$this_1.xmlData.getChildren("waves/wave");$this_1.theWaves=$p.createJavaArray("WAVE",[xmlWaves.length]);for(var i=0;i<xmlWaves.length;i++){$this_1.theWaves[i]=new WAVE(itheWaypoints,xmlWaves[i].getInt("enemydistance"),xmlWaves[i].getChildren("enemy"),itheGui,$this_1.defenseMap)}}function $constr_0(){$superCstr()}function $constr(){if(arguments.length===4){$constr_4.apply($this_1,arguments)}else if(arguments.length===0){$constr_0.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return WAVES}();$p.WAVES=WAVES;var WAYPOINTS=function(){function WAYPOINTS(){var $this_1=this;function $superCstr(){$p.extendClassChain($this_1)}$this_1.xmlData=null;$this_1.startPoint=$p.createJavaArray("int",[2]);$this_1.endPoint=$p.createJavaArray("int",[2]);$this_1.wayPoints=null;function getStart$0(){return $this_1.startPoint}$p.addMethod($this_1,"getStart",getStart$0,false);function getEnd$0(){return $this_1.endPoint}$p.addMethod($this_1,"getEnd",getEnd$0,false);function getWP$0(){return $this_1.wayPoints}$p.addMethod($this_1,"getWP",getWP$0,false);function $constr_1(mapFile){$superCstr();$this_1.xmlData=$p.loadXML(mapFile+"/waypoints.xml");var xmlWayPoints=$this_1.xmlData.getChildren("waypoints/waypoint");$this_1.wayPoints=$p.createJavaArray("int",[xmlWayPoints.length-2,2]);for(var i=0;i<xmlWayPoints.length;i++){var temp=xmlWayPoints[i].getContent();var temp2=$p.__split(temp,",");if(i==0){$this_1.startPoint[0]=$p.parseInt(temp2[0]);$this_1.startPoint[1]=$p.parseInt(temp2[1])}else if(i==xmlWayPoints.length-1){$this_1.endPoint[0]=$p.parseInt(temp2[0]);$this_1.endPoint[1]=$p.parseInt(temp2[1])}else{$this_1.wayPoints[i-1][0]=$p.parseInt(temp2[0]);$this_1.wayPoints[i-1][1]=$p.parseInt(temp2[1])}}}function $constr(){if(arguments.length===1){$constr_1.apply($this_1,arguments)}else $superCstr()}$constr.apply(null,arguments)}return WAYPOINTS}();$p.WAYPOINTS=WAYPOINTS;var menuScale=1;var hudScale=1;var globalPlatform=2;function setup(){$p.size(960,600);$p.frameRate(60);fpsFont=$p.createFont("Arial",48);theAnimations=new ANIMATIONS;theMenu=new MENU(0,false)}$p.setup=setup;function draw(){mouseXp=$p.__int_cast($p.mouseX/scaleFactor);mouseYp=$p.__int_cast($p.mouseY/scaleFactor);globalDisplay()}$p.draw=draw;function mouseReleased(){if(theMenu!=null){theMenu.mouseClicked()}}$p.mouseReleased=mouseReleased;function mouseClicked(){if(inputHandler!=null){if($p.mouseButton==$p.LEFT){inputHandler.mouseClick()}}}$p.mouseClicked=mouseClicked;function mouseDragged(){if(inputHandler!=null){if($p.mouseButton==$p.RIGHT){inputHandler.scroll(($p.mouseX-$p.pmouseX)*.7,($p.mouseY-$p.pmouseY)*.7)}}if(theMenu!=null){if($p.mouseButton==$p.RIGHT){theMenu.scroll(($p.mouseY-$p.pmouseY)*.7)}}}$p.mouseDragged=mouseDragged;var Collections=new Collection;function displaySortFunction(o1,o2){var position1=0;var position2=0;if($p.__instanceof(o1,TOWER)){var temp=o1;position1=(temp.position[1]+.5)*defenseMap.tileSize}else{var temp=o1;if(temp.enemyDied==false&&temp.enemyAlive==false&&(temp.moveDirection==1||temp.moveDirection==2)){position1=-50}else{position1=temp.position[1]}}if($p.__instanceof(o2,TOWER)){var temp=o2;position2=(temp.position[1]+.5)*defenseMap.tileSize}else{var temp=o2;if(temp.enemyDied==false&&temp.enemyAlive==false&&(temp.moveDirection==1||temp.moveDirection==2)){position2=-50}else{position2=temp.position[1]}}return $p.__int_cast(position2-position1)}function enemySortFunction(enemy1,enemy2){var returnVar=0;returnVar=$p.__int_cast(enemy2.moveComplete-enemy1.moveComplete);return returnVar}var developerMode=false;var scaleFactor=1;var defenseMap=null;var inputHandler=null;var theAnimations=null;var theMenu=null;var loadingMap=false;var loadedMap=false;var mapNameTemp=null;var difficultyTemp=0;var mapCount=0;var showFps=false;var globalSpeed=1;var fpsFont=null;var highGraphicsQuality=false;var antiAliasing=false;var mouseXp=0;var mouseYp=0;function globalDisplay(){if(defenseMap!=null){defenseMap.display()}if(inputHandler!=null){inputHandler.display()}if(theMenu!=null){theMenu.display()}if(loadingMap==true){$p.background(0);$p.fill(255);$p.textFont(fpsFont,24);$p.textAlign($p.CENTER);$p.text("LOADING ...",$p.width/2,$p.height/2-10);if(loadedMap==false&&$p.millis()-mapCount>3e3){loadedMap=true;defenseMap=new THEMAP(mapNameTemp,hudScale,menuScale,difficultyTemp);inputHandler=new INPUT(defenseMap)}}if(showFps==true){$p.textFont(fpsFont,12);$p.textAlign($p.RIGHT);$p.fill(255);$p.text($p.width+"x"+$p.height+" @ "+$p.parseInt($p.__frameRate)+" fps",$p.width-2,12);$p.textAlign($p.LEFT)}}$p.globalDisplay=globalDisplay;function unserializeMap(istring,mapSizeX,mapSizeY){mapSizeX=$p.parseInt(mapSizeX);mapSizeY=$p.parseInt(mapSizeY);var array_x=$p.__split(istring,"_");var returnMe=$p.createJavaArray("int",[mapSizeX,mapSizeY,2]);for(var i=0;i<array_x.length;i++){var array_y=$p.__split(array_x[i],"#");for(var j=0;j<array_y.length;j++){var tiles=$p.__split(array_y[j],",");returnMe[i][j][0]=$p.parseInt(tiles[0]);returnMe[i][j][1]=$p.parseInt(tiles[1])}}return returnMe}$p.unserializeMap=unserializeMap;function pixelToTiles(x,y,tileSize){tileSize*=defenseMap.zoom;return[(x-x%tileSize)/tileSize,(y-y%tileSize)/tileSize]}$p.pixelToTiles=pixelToTiles;function startGame(mapName,difficulty){loadingMap=true;theMenu=null;theAnimations=null;mapNameTemp=mapName;difficultyTemp=difficulty;mapCount=$p.millis()}$p.startGame=startGame;function showAfterMatch(wonTheGame){defenseMap=null;inputHandler=null;theAnimations=new ANIMATIONS;theMenu=new MENU(2,wonTheGame)}$p.showAfterMatch=showAfterMatch;function listFiles(dir){var file=new File(dir);if(file.isDirectory()){var files=file.listFiles();return files}else{return null}}$p.listFiles=listFiles});	new Processing(document.getElementById("dm"),sketch);
	</script>
	
	<script type="text/javascript">
	var pkBaseURL = (("https:" == document.location.protocol) ? "https://piwik.defensemania.de/" : "http://piwik.defensemania.de/");
	document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
	</script><script type="text/javascript">
	try {
	var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
	piwikTracker.trackPageView();
	piwikTracker.enableLinkTracking();
	} catch( err ) {}
	</script><noscript><p><img src="http://piwik.defensemania.de/piwik.php?idsite=1" style="border:0" alt="" /></p></noscript>
	
	</body>
</html>
